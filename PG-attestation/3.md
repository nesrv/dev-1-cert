

## –û–ø–µ—Ä–∞—Ü–∏–∏¬†INSERT, UPDATE –∏ DELETE¬†—Å –ø–æ–º–æ—â—å—é –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞¬†"MERGE".¬†–°–∏–Ω—Ç–∞–∫—Å–∏—Å –∏ –æ—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã


# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ MERGE –≤ PostgreSQL –¥–ª—è INSERT, UPDATE –∏ DELETE

–û–ø–µ—Ä–∞—Ç–æ—Ä MERGE (—Ç–∞–∫–∂–µ –∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫–∞–∫ "upsert") –≤ PostgreSQL –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ INSERT, UPDATE –∏ DELETE –≤ –æ–¥–Ω–æ–º –≤—ã—Ä–∞–∂–µ–Ω–∏–∏, —á—Ç–æ –æ—á–µ–Ω—å —É–¥–æ–±–Ω–æ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏.

## –û—Å–Ω–æ–≤–Ω–æ–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å MERGE

```sql
MERGE INTO target_table USING source_table
ON merge_condition
WHEN MATCHED THEN
    UPDATE SET column1 = value1, column2 = value2, ...
    [DELETE WHERE condition]
WHEN NOT MATCHED THEN
    INSERT (column1, column2, ...) VALUES (value1, value2, ...);
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ë–∞–∑–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä —Å INSERT –∏ UPDATE

```sql
-- –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã
CREATE TABLE target_products (
    product_id INT PRIMARY KEY,
    product_name VARCHAR(100),
    price DECIMAL(10, 2),
    quantity INT
);

CREATE TABLE source_products (
    product_id INT PRIMARY KEY,
    product_name VARCHAR(100),
    price DECIMAL(10, 2),
    quantity INT
);

-- –í—Å—Ç–∞–≤–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
INSERT INTO target_products VALUES 
(1, 'Laptop', 999.99, 10),
(2, 'Phone', 499.99, 20);

INSERT INTO source_products VALUES 
(1, 'Laptop', 899.99, 15), -- –û–±–Ω–æ–≤–∏–º —Ü–µ–Ω—É –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
(3, 'Tablet', 299.99, 30); -- –ù–æ–≤—ã–π —Ç–æ–≤–∞—Ä

-- –í—ã–ø–æ–ª–Ω—è–µ–º MERGE
MERGE INTO target_products t
USING source_products s
ON t.product_id = s.product_id
WHEN MATCHED THEN
    UPDATE SET 
        product_name = s.product_name,
        price = s.price,
        quantity = s.quantity
WHEN NOT MATCHED THEN
    INSERT (product_id, product_name, price, quantity)
    VALUES (s.product_id, s.product_name, s.price, s.quantity);
```

### 2. –ü—Ä–∏–º–µ—Ä —Å DELETE —É—Å–ª–æ–≤–∏–µ–º

```sql
-- –î–æ–±–∞–≤–∏–º —É—Å–ª–æ–≤–∏–µ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
MERGE INTO target_products t
USING source_products s
ON t.product_id = s.product_id
WHEN MATCHED AND s.quantity = 0 THEN
    DELETE
WHEN MATCHED THEN
    UPDATE SET 
        product_name = s.product_name,
        price = s.price,
        quantity = s.quantity
WHEN NOT MATCHED THEN
    INSERT (product_id, product_name, price, quantity)
    VALUES (s.product_id, s.product_name, s.price, s.quantity);
```

### 3. –ü—Ä–∏–º–µ—Ä —Å –ø–æ–¥–∑–∞–ø—Ä–æ—Å–æ–º –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞

```sql
-- MERGE —Å –ø–æ–¥–∑–∞–ø—Ä–æ—Å–æ–º –≤–º–µ—Å—Ç–æ —Ç–∞–±–ª–∏—Ü—ã
MERGE INTO target_products t
USING (
    SELECT product_id, product_name, price, quantity 
    FROM source_products 
    WHERE price > 300
) s
ON t.product_id = s.product_id
WHEN MATCHED THEN
    UPDATE SET 
        product_name = s.product_name,
        price = s.price,
        quantity = s.quantity
WHEN NOT MATCHED THEN
    INSERT (product_id, product_name, price, quantity)
    VALUES (s.product_id, s.product_name, s.price, s.quantity);
```

### 4. –ü—Ä–∏–º–µ—Ä —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏

```sql
MERGE INTO target_products t
USING source_products s
ON t.product_id = s.product_id
WHEN MATCHED AND t.price > s.price THEN
    UPDATE SET price = s.price -- –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ü–µ–Ω–∞ –≤ –∏—Å—Ç–æ—á–Ω–∏–∫–µ –Ω–∏–∂–µ
WHEN MATCHED AND t.price <= s.price THEN
    DO NOTHING -- –ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º, –µ—Å–ª–∏ —Ü–µ–Ω–∞ –≤ –∏—Å—Ç–æ—á–Ω–∏–∫–µ –≤—ã—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–∞
WHEN NOT MATCHED THEN
    INSERT (product_id, product_name, price, quantity)
    VALUES (s.product_id, s.product_name, s.price, s.quantity);
```

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏

1. –û–ø–µ—Ä–∞—Ç–æ—Ä MERGE –±—ã–ª –¥–æ–±–∞–≤–ª–µ–Ω –≤ PostgreSQL –Ω–∞—á–∏–Ω–∞—è —Å –≤–µ—Ä—Å–∏–∏ 15.
2. MERGE –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–∞–∫ –µ–¥–∏–Ω–∞—è –∞—Ç–æ–º–∞—Ä–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è.
3. –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ WHEN MATCHED –∏ WHEN NOT MATCHED —É—Å–ª–æ–≤–∏–π, –Ω–æ –ø–æ—Ä—è–¥–æ–∫ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ.
4. –î–ª—è –±–æ–ª–µ–µ —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π PostgreSQL –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å INSERT ... ON CONFLICT (UPSERT) –¥–ª—è –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.

MERGE –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–µ–Ω –ø—Ä–∏:
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü
- –ü–∞–∫–µ—Ç–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö –¥–∞–Ω–Ω—ã—Ö
- –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–ª–æ–∂–Ω–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π


## –û–ø–µ—Ä–∞—Ç–æ—Ä—ã –≤–µ—Ç–≤–ª–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏. "DECODE", "CASE WHEN"(2 —Å–ø–æ—Å–æ–±–∞). –°–∏–Ω—Ç–∞–∫—Å–∏—Å –∏ –æ—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã.

# –û–ø–µ—Ä–∞—Ç–æ—Ä—ã –≤–µ—Ç–≤–ª–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏ –≤ PostgreSQL

PostgreSQL –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –¥–ª—è –≤–µ—Ç–≤–ª–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏ –≤ SQL-–∑–∞–ø—Ä–æ—Å–∞—Ö. –†–∞—Å—Å–º–æ—Ç—Ä–∏–º –æ—Å–Ω–æ–≤–Ω—ã–µ –∏–∑ –Ω–∏—Ö: DECODE –∏ CASE WHEN (–≤ –¥–≤—É—Ö –≤–∞—Ä–∏–∞–Ω—Ç–∞—Ö).

## 1. DECODE

DECODE - —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è, –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è CASE WHEN, –Ω–æ —Å –¥—Ä—É–≥–∏–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º (—É–Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∞ –∏–∑ Oracle).

### –°–∏–Ω—Ç–∞–∫—Å–∏—Å:
```sql
DECODE(–≤—ã—Ä–∞–∂–µ–Ω–∏–µ, –∑–Ω–∞—á–µ–Ω–∏–µ1, —Ä–µ–∑—É–ª—å—Ç–∞—Ç1, 
                   –∑–Ω–∞—á–µ–Ω–∏–µ2, —Ä–µ–∑—É–ª—å—Ç–∞—Ç2, 
                   ...
                   –∑–Ω–∞—á–µ–Ω–∏–µN, —Ä–µ–∑—É–ª—å—Ç–∞—ÇN, 
                   default_—Ä–µ–∑—É–ª—å—Ç–∞—Ç)
```

### –ü—Ä–∏–º–µ—Ä:
```sql
SELECT product_name, 
       DECODE(category_id, 1, 'Electronics', 
                           2, 'Clothing', 
                           3, 'Food', 
                           'Other') AS category_name
FROM products;
```

## 2. CASE WHEN (–¥–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞)

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä–æ—Å—Ç–æ–µ CASE –≤—ã—Ä–∞–∂–µ–Ω–∏–µ

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ DECODE, –Ω–æ —Å –¥—Ä—É–≥–∏–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º.

#### –°–∏–Ω—Ç–∞–∫—Å–∏—Å:
```sql
CASE –≤—ã—Ä–∞–∂–µ–Ω–∏–µ
    WHEN –∑–Ω–∞—á–µ–Ω–∏–µ1 THEN —Ä–µ–∑—É–ª—å—Ç–∞—Ç1
    WHEN –∑–Ω–∞—á–µ–Ω–∏–µ2 THEN —Ä–µ–∑—É–ª—å—Ç–∞—Ç2
    ...
    WHEN –∑–Ω–∞—á–µ–Ω–∏–µN THEN —Ä–µ–∑—É–ª—å—Ç–∞—ÇN
    ELSE default_—Ä–µ–∑—É–ª—å—Ç–∞—Ç
END
```

#### –ü—Ä–∏–º–µ—Ä:
```sql
SELECT product_name, 
       CASE category_id
           WHEN 1 THEN 'Electronics'
           WHEN 2 THEN 'Clothing'
           WHEN 3 THEN 'Food'
           ELSE 'Other'
       END AS category_name
FROM products;
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ–∏—Å–∫–æ–≤–æ–µ CASE –≤—ã—Ä–∞–∂–µ–Ω–∏–µ

–ë–æ–ª–µ–µ –≥–∏–±–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É—Å–ª–æ–≤–∏—è.

#### –°–∏–Ω—Ç–∞–∫—Å–∏—Å:
```sql
CASE
    WHEN —É—Å–ª–æ–≤–∏–µ1 THEN —Ä–µ–∑—É–ª—å—Ç–∞—Ç1
    WHEN —É—Å–ª–æ–≤–∏–µ2 THEN —Ä–µ–∑—É–ª—å—Ç–∞—Ç2
    ...
    WHEN —É—Å–ª–æ–≤–∏–µN THEN —Ä–µ–∑—É–ª—å—Ç–∞—ÇN
    ELSE default_—Ä–µ–∑—É–ª—å—Ç–∞—Ç
END
```

#### –ü—Ä–∏–º–µ—Ä:
```sql
SELECT product_name, price,
       CASE
           WHEN price < 100 THEN 'Cheap'
           WHEN price >= 100 AND price < 500 THEN 'Medium'
           WHEN price >= 500 THEN 'Expensive'
           ELSE 'Not priced'
       END AS price_category
FROM products;
```

## –û—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã:

1. **–í—ã—Ä–∞–∂–µ–Ω–∏–µ/—É—Å–ª–æ–≤–∏–µ** - —Ç–æ, —á—Ç–æ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è –¥–ª—è –≤—ã–±–æ—Ä–∞ –≤–µ—Ç–≤–∏
2. **THEN** - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —É—Å–ª–æ–≤–∏—è
3. **ELSE** - –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
4. **END** - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ CASE –≤—ã—Ä–∞–∂–µ–Ω–∏—è

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –≤ PostgreSQL:

- DECODE –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π SQL, –Ω–æ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ PostgreSQL —á–µ—Ä–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ oracle_fdw
- CASE WHEN —è–≤–ª—è–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º SQL –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- CASE –≤—ã—Ä–∞–∂–µ–Ω–∏—è –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ SELECT, WHERE, GROUP BY, ORDER BY –∏ –¥—Ä—É–≥–∏—Ö —á–∞—Å—Ç—è—Ö –∑–∞–ø—Ä–æ—Å–∞
- –ú–æ–∂–Ω–æ –≤–∫–ª–∞–¥—ã–≤–∞—Ç—å CASE –≤—ã—Ä–∞–∂–µ–Ω–∏—è –¥—Ä—É–≥ –≤ –¥—Ä—É–≥–∞ –¥–ª—è —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏




# –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã –≤ PostgreSQL —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º WITH RECURSIVE

–í PostgreSQL –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (–¥–µ—Ä–µ–≤—å—è–º–∏, –≥—Ä–∞—Ñ–∞–º–∏) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è `WITH RECURSIVE` –≤ —Å–æ—á–µ—Ç–∞–Ω–∏–∏ —Å `UNION ALL`. –≠—Ç–æ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö.

## –ë–∞–∑–æ–≤—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å

```sql
WITH RECURSIVE recursive_query_name AS (
    -- –ù–µ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è —á–∞—Å—Ç—å (–Ω–∞—á–∞–ª—å–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ)
    SELECT initial_columns
    FROM initial_table
    WHERE initial_condition
    
    UNION ALL
    
    -- –†–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è —á–∞—Å—Ç—å
    SELECT recursive_columns
    FROM recursive_table
    JOIN recursive_query_name ON join_condition
    WHERE recursive_condition
)
SELECT * FROM recursive_query_name;
```

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **–ù–µ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è —á–∞—Å—Ç—å** - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∞—á–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ (–∫–æ—Ä–Ω–∏ –¥–µ—Ä–µ–≤–∞)
2. **UNION ALL** - –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
3. **–†–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è —á–∞—Å—Ç—å** - —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ —Å–∞–º –∑–∞–ø—Ä–æ—Å, —Å—Ç—Ä–æ—è –∏–µ—Ä–∞—Ä—Ö–∏—é

## –ü—Ä–∏–º–µ—Ä 1: –ò–µ—Ä–∞—Ä—Ö–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤

–î–æ–ø—É—Å—Ç–∏–º, –µ—Å—Ç—å —Ç–∞–±–ª–∏—Ü–∞ employees —Å –ø–æ–ª—è–º–∏ id, name –∏ manager_id:

```sql
WITH RECURSIVE employee_hierarchy AS (
    -- –ë–∞–∑–æ–≤—ã–π —Å–ª—É—á–∞–π: –Ω–∞—á–∞–ª—å–Ω–∏–∫–∏ (—É –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–∞)
    SELECT id, name, manager_id, 1 AS level
    FROM employees
    WHERE manager_id IS NULL
    
    UNION ALL
    
    -- –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π —Å–ª—É—á–∞–π: –ø–æ–¥—á–∏–Ω–µ–Ω–Ω—ã–µ
    SELECT e.id, e.name, e.manager_id, eh.level + 1
    FROM employees e
    JOIN employee_hierarchy eh ON e.manager_id = eh.id
)
SELECT id, name, level FROM employee_hierarchy
ORDER BY level, name;
```

## –ü—Ä–∏–º–µ—Ä 2: –î–µ—Ä–µ–≤–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π

–î–ª—è —Ç–∞–±–ª–∏—Ü—ã categories —Å –ø–æ–ª—è–º–∏ id, name, parent_id:

```sql
WITH RECURSIVE category_tree AS (
    -- –ë–∞–∑–æ–≤—ã–π —Å–ª—É—á–∞–π: –∫–æ—Ä–Ω–µ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    SELECT id, name, parent_id, ARRAY[name] AS path
    FROM categories
    WHERE parent_id IS NULL
    
    UNION ALL
    
    -- –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π —Å–ª—É—á–∞–π: –¥–æ—á–µ—Ä–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    SELECT c.id, c.name, c.parent_id, ct.path || c.name
    FROM categories c
    JOIN category_tree ct ON c.parent_id = ct.id
)
SELECT id, name, array_to_string(path, ' > ') AS full_path
FROM category_tree
ORDER BY path;
```

## –ü—Ä–∏–º–µ—Ä 3: –ü–æ–∏—Å–∫ –ø—É—Ç–µ–π –≤ –≥—Ä–∞—Ñ–µ

–î–ª—è —Ç–∞–±–ª–∏—Ü—ã graph —Å –ø–æ–ª—è–º–∏ source, target, weight:

```sql
WITH RECURSIVE paths AS (
    -- –ë–∞–∑–æ–≤—ã–π —Å–ª—É—á–∞–π: –ø—É—Ç–∏ –¥–ª–∏–Ω–æ–π 1
    SELECT source, target, weight, ARRAY[source, target] AS path
    FROM graph
    
    UNION ALL
    
    -- –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π —Å–ª—É—á–∞–π: —É–¥–ª–∏–Ω–µ–Ω–∏–µ –ø—É—Ç–µ–π
    SELECT p.source, g.target, p.weight + g.weight, p.path || g.target
    FROM paths p
    JOIN graph g ON p.target = g.source
    WHERE NOT g.target = ANY(p.path) -- –∏–∑–±–µ–≥–∞–µ–º —Ü–∏–∫–ª–æ–≤
)
SELECT * FROM paths
WHERE source = 1 AND target = 5
ORDER BY weight;
```

## –í–∞–∂–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

1. **–£—Å–ª–æ–≤–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏** - —Ä–µ–∫—É—Ä—Å–∏—è –ø—Ä–µ–∫—Ä–∞—â–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è —á–∞—Å—Ç—å –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫
2. **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Ü–∏–∫–ª–æ–≤** - –≤–∞–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É (–∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ 3)
3. **–ì–ª—É–±–∏–Ω–∞ —Ä–µ–∫—É—Ä—Å–∏–∏** - PostgreSQL –∏–º–µ–µ—Ç –ª–∏–º–∏—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 100), –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å: `SET max_recursive_iterations TO 500;`

## –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ —Å–æ–µ–¥–∏–Ω—è–µ–º—ã—Ö —Å—Ç–æ–ª–±—Ü–∞—Ö
2. –î–æ–±–∞–≤–ª—è–π—Ç–µ —É—Å–ª–æ–≤–∏—è WHERE –≤ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—É—é —á–∞—Å—Ç—å –¥–ª—è —Ä–∞–Ω–Ω–µ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
3. –î–ª—è –±–æ–ª—å—à–∏—Ö –∏–µ—Ä–∞—Ä—Ö–∏–π —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã - –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–µ—à–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –∑–∞–¥–∞—á–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ SQL.


# –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π —Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª

```sql
WITH RECURSIVE t(n,factorial) AS (
  VALUES (0,1)
  UNION ALL
  SELECT t.n+1, t.factorial*(t.n+1) FROM t WHERE t.n < 10
)
SELECT * FROM t;
```

# –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π —Ñ–∏–±–æ–Ω–∞—á–∏
```sql
WITH RECURSIVE fibonacci(n, fib_n, next_fib) AS (
    -- –ë–∞–∑–æ–≤—ã–π —Å–ª—É—á–∞–π: –ø–µ—Ä–≤—ã–µ –¥–≤–∞ —á–∏—Å–ª–∞ –§–∏–±–æ–Ω–∞—á—á–∏
    SELECT 1, 0, 1    
    UNION ALL       
    SELECT n + 1, next_fib, fib_n + next_fib
    FROM fibonacci
    WHERE n < 20 -- –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Ç–µ—Ä–∞—Ü–∏–π
)
SELECT n, fib_n AS fibonacci_number
FROM fibonacci
ORDER BY n;
```


# –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ `LEAD()` –≤ PostgreSQL

–§—É–Ω–∫—Ü–∏—è `LEAD()` - —ç—Ç–æ –æ–∫–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–æ–∫–∏ –≤ –Ω–∞–±–æ—Ä–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–∞–º–æ—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. –í–æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∏–º–µ—Ä–æ–≤:

## 1. –ë–∞–∑–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä —Å —á–∏—Å–ª–∞–º–∏

```sql
SELECT 
    num,
    LEAD(num) OVER (ORDER BY num) AS next_num
FROM (VALUES (1), (5), (10), (15)) AS t(num);
```

–†–µ–∑—É–ª—å—Ç–∞—Ç:
```
 num | next_num
-----+----------
   1 |        5
   5 |       10
  10 |       15
  15 |     NULL
```

## 2. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –∏ —Å–ª–µ–¥—É—é—â–µ–π –¥–∞—Ç—ã

```sql
SELECT 
    employee_id,
    event_date,
    LEAD(event_date) OVER (PARTITION BY employee_id ORDER BY event_date) AS next_event_date
FROM employee_events;
```

## 3. –†–∞—Å—á–µ—Ç —Ä–∞–∑–Ω–∏—Ü—ã –º–µ–∂–¥—É —Ç–µ–∫—É—â–∏–º –∏ —Å–ª–µ–¥—É—é—â–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º

```sql
SELECT 
    product_id,
    price_date,
    price,
    LEAD(price) OVER (PARTITION BY product_id ORDER BY price_date) AS next_price,
    LEAD(price) OVER (PARTITION BY product_id ORDER BY price_date) - price AS price_change
FROM product_prices;
```

## 4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (offset –∏ default)

```sql
SELECT 
    month,
    revenue,
    LEAD(revenue, 2, 0) OVER (ORDER BY month) AS revenue_two_months_later
FROM monthly_sales;
```

## 5. –ê–Ω–∞–ª–∏–∑ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```sql
SELECT 
    user_id,
    action,
    action_time,
    LEAD(action) OVER (PARTITION BY user_id ORDER BY action_time) AS next_action,
    LEAD(action_time) OVER (PARTITION BY user_id ORDER BY action_time) - action_time AS time_to_next_action
FROM user_actions;
```

## 6. –ù–∞—Ö–æ–∂–¥–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–π –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–æ–π –∑–∞—Ä–ø–ª–∞—Ç—ã –≤ –æ—Ç–¥–µ–ª–µ

```sql
SELECT 
    department,
    employee_name,
    salary,
    LEAD(salary) OVER (PARTITION BY department ORDER BY salary DESC) AS next_higher_salary
FROM employees;
```

## 7. –ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–æ–º–µ–∂—É—Ç–∫–æ–≤ –º–µ–∂–¥—É –∑–∞–∫–∞–∑–∞–º–∏

```sql
SELECT 
    customer_id,
    order_date,
    LEAD(order_date) OVER (PARTITION BY customer_id ORDER BY order_date) AS next_order_date,
    AGE(LEAD(order_date) OVER (PARTITION BY customer_id ORDER BY order_date), order_date) AS days_between_orders
FROM orders;
```

–§—É–Ω–∫—Ü–∏—è `LEAD()` –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω–∞, –∫–æ–≥–¥–∞ –≤–∞–º –Ω—É–∂–Ω–æ —Å—Ä–∞–≤–Ω–∏—Ç—å —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–æ–∫—É —Å–æ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–æ–∫–æ–π –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ, —á—Ç–æ —á–∞—Å—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤, –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π —Å–æ–±—ã—Ç–∏–π –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∑–Ω–∞—á–µ–Ω–∏–π –≤–æ –≤—Ä–µ–º–µ–Ω–∏.

# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `employee_events` –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

–í–æ—Ç SQL-–∫–æ–¥ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –µ–µ –¥–∞–Ω–Ω—ã–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Ñ—É–Ω–∫—Ü–∏–∏ `LEAD()`:

```sql
-- –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É employee_events
CREATE TABLE employee_events (
    event_id SERIAL PRIMARY KEY,
    employee_id INTEGER NOT NULL,
    event_name VARCHAR(100),
    event_date DATE NOT NULL
);

-- –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
INSERT INTO employee_events (employee_id, event_name, event_date) VALUES
-- –°–æ–±—ã—Ç–∏—è –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ 101
(101, '–ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã', '2023-01-10'),
(101, '–ü–æ–≤—ã—à–µ–Ω–∏–µ', '2023-04-15'),
(101, '–ü–µ—Ä–µ–≤–æ–¥ –≤ –¥—Ä—É–≥–æ–π –æ—Ç–¥–µ–ª', '2023-08-20'),
(101, '–û–∫–æ–Ω—á–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã', '2023-12-05'),

-- –°–æ–±—ã—Ç–∏—è –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ 102
(102, '–ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã', '2023-02-01'),
(102, '–û–±—É—á–µ–Ω–∏–µ', '2023-03-10'),
(102, '–ë–æ–ª—å–Ω–∏—á–Ω—ã–π', '2023-06-05'),
(102, '–í–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –∏–∑ –±–æ–ª—å–Ω–∏—á–Ω–æ–≥–æ', '2023-06-20'),

-- –°–æ–±—ã—Ç–∏—è –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ 103
(103, '–ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã', '2023-01-15'),
(103, '–ü—Ä–µ–º–∏—è', '2023-05-01'),
(103, '–û—Ç–ø—É—Å–∫', '2023-07-01'),
(103, '–í–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –∏–∑ –æ—Ç–ø—É—Å–∫–∞', '2023-07-15'),
(103, '–û–∫–æ–Ω—á–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã', '2023-11-30'),

-- –°–æ–±—ã—Ç–∏—è –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ 104
(104, '–ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã', '2023-03-01'),
(104, '–û–±—É—á–µ–Ω–∏–µ', '2023-04-15'),
(104, '–ü–æ–≤—ã—à–µ–Ω–∏–µ', '2023-09-10');
```

## –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ —Å —ç—Ç–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏

–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤–∞—à –∑–∞–ø—Ä–æ—Å —Å —Ñ—É–Ω–∫—Ü–∏–µ–π `LEAD()`:

```sql
SELECT 
    employee_id,
    event_date,
    event_name,
    LEAD(event_date) OVER (PARTITION BY employee_id ORDER BY event_date) AS next_event_date,
    LEAD(event_name) OVER (PARTITION BY employee_id ORDER BY event_date) AS next_event_name
FROM employee_events
ORDER BY employee_id, event_date;
```

## –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–ø—Ä–∏–º–µ—Ä –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ 101):

```
 employee_id | event_date |       event_name       | next_event_date |    next_event_name    
-------------+------------+------------------------+-----------------+----------------------
         101 | 2023-01-10 | –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã          | 2023-04-15      | –ü–æ–≤—ã—à–µ–Ω–∏–µ
         101 | 2023-04-15 | –ü–æ–≤—ã—à–µ–Ω–∏–µ              | 2023-08-20      | –ü–µ—Ä–µ–≤–æ–¥ –≤ –¥—Ä—É–≥–æ–π –æ—Ç–¥–µ–ª
         101 | 2023-08-20 | –ü–µ—Ä–µ–≤–æ–¥ –≤ –¥—Ä—É–≥–æ–π –æ—Ç–¥–µ–ª | 2023-12-05      | –û–∫–æ–Ω—á–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã
         101 | 2023-12-05 | –û–∫–æ–Ω—á–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã       | NULL            | NULL
```

–≠—Ç–æ—Ç –ø—Ä–∏–º–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏—è `LEAD()` –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–∞—Ç—É –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞, —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω–æ–≥–æ –ø–æ –¥–∞—Ç–µ. –î–ª—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–±—ã—Ç–∏—è –∫–∞–∂–¥–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è –±—É–¥—É—Ç `NULL`, —Ç–∞–∫ –∫–∞–∫ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–æ–±—ã—Ç–∏—è –Ω–µ—Ç.



# –ü—Ä–æ—Å—Ç—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `LAG()` –≤ PostgreSQL

–§—É–Ω–∫—Ü–∏—è `LAG()` –ø–æ—Ö–æ–∂–∞ –Ω–∞ `LEAD()`, –Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å—Ç—Ä–æ–∫–∏ –≤–º–µ—Å—Ç–æ —Å–ª–µ–¥—É—é—â–µ–π. –í–æ—Ç –¥–≤–∞ –ø—Ä–æ—Å—Ç—ã—Ö –ø—Ä–∏–º–µ—Ä–∞:

## –ü—Ä–∏–º–µ—Ä 1: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –∏ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –∑–∞—Ä–ø–ª–∞—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞

```sql
-- –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É
CREATE TABLE employee_salaries (
    employee_id INT,
    year INT,
    salary DECIMAL(10, 2)
);

-- –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–º–∏
INSERT INTO employee_salaries VALUES
(1, 2020, 50000),
(1, 2021, 52000),
(1, 2022, 55000),
(1, 2023, 58000),
(2, 2021, 45000),
(2, 2022, 47000),
(2, 2023, 50000);

-- –ó–∞–ø—Ä–æ—Å —Å LAG()
SELECT 
    employee_id,
    year,
    salary,
    LAG(salary) OVER (PARTITION BY employee_id ORDER BY year) AS previous_salary,
    salary - LAG(salary) OVER (PARTITION BY employee_id ORDER BY year) AS salary_increase
FROM employee_salaries;
```

–†–µ–∑—É–ª—å—Ç–∞—Ç:
```
employee_id | year | salary  | previous_salary | salary_increase
------------+------+---------+-----------------+----------------
          1 | 2020 | 50000.00| NULL            | NULL
          1 | 2021 | 52000.00| 50000.00        | 2000.00
          1 | 2022 | 55000.00| 52000.00        | 3000.00
          1 | 2023 | 58000.00| 55000.00        | 3000.00
          2 | 2021 | 45000.00| NULL            | NULL
          2 | 2022 | 47000.00| 45000.00        | 2000.00
          2 | 2023 | 50000.00| 47000.00        | 3000.00
```

## –ü—Ä–∏–º–µ—Ä 2: –ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–æ–º–µ–∂—É—Ç–∫–æ–≤ –º–µ–∂–¥—É –∑–∞–∫–∞–∑–∞–º–∏

```sql
-- –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É –∑–∞–∫–∞–∑–æ–≤
CREATE TABLE customer_orders (
    order_id INT,
    customer_id INT,
    order_date DATE
);

-- –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–º–∏
INSERT INTO customer_orders VALUES
(1, 101, '2023-01-05'),
(2, 101, '2023-01-15'),
(3, 101, '2023-02-10'),
(4, 102, '2023-01-10'),
(5, 102, '2023-03-01'),
(6, 103, '2023-02-20');

-- –ó–∞–ø—Ä–æ—Å —Å LAG()
SELECT 
    order_id,
    customer_id,
    order_date,
    LAG(order_date) OVER (PARTITION BY customer_id ORDER BY order_date) AS previous_order_date,
    order_date - LAG(order_date) OVER (PARTITION BY customer_id ORDER BY order_date) AS days_since_last_order
FROM customer_orders;
```

–†–µ–∑—É–ª—å—Ç–∞—Ç:
```
order_id | customer_id | order_date | previous_order_date | days_since_last_order
---------+-------------+------------+---------------------+----------------------
       1 |         101 | 2023-01-05 | NULL                | NULL
       2 |         101 | 2023-01-15 | 2023-01-05          | 10
       3 |         101 | 2023-02-10 | 2023-01-15          | 26
       4 |         102 | 2023-01-10 | NULL                | NULL
       5 |         102 | 2023-03-01 | 2023-01-10          | 50
       6 |         103 | 2023-02-20 | NULL                | NULL
```

–§—É–Ω–∫—Ü–∏—è `LAG()` –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏.












# –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `FIRST_VALUE()` –≤ PostgreSQL

–§—É–Ω–∫—Ü–∏—è `FIRST_VALUE()` ‚Äî —ç—Ç–æ –æ–∫–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω–æ–º –Ω–∞–±–æ—Ä–µ —Å—Ç—Ä–æ–∫. –í–æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∏–º–µ—Ä–æ–≤:

## –ü—Ä–∏–º–µ—Ä 1: –ù–∞—Ö–æ–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–π –∑–∞—Ä–ø–ª–∞—Ç—ã –∫–∞–∂–¥–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞

```sql
-- –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –∑–∞—Ä–ø–ª–∞—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
CREATE TABLE employee_salaries (
    employee_id INT,
    year INT,
    salary DECIMAL(10, 2)
);

-- –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–º–∏
INSERT INTO employee_salaries VALUES
(1, 2020, 50000),
(1, 2021, 52000),
(1, 2022, 55000),
(1, 2023, 58000),
(2, 2021, 45000),
(2, 2022, 47000),
(2, 2023, 50000);

-- –ó–∞–ø—Ä–æ—Å —Å FIRST_VALUE()
SELECT 
    employee_id,
    year,
    salary,
    FIRST_VALUE(salary) OVER (PARTITION BY employee_id ORDER BY year) AS first_salary,
    salary - FIRST_VALUE(salary) OVER (PARTITION BY employee_id ORDER BY year) AS salary_growth
FROM employee_salaries;
```

–†–µ–∑—É–ª—å—Ç–∞—Ç:
```
employee_id | year | salary  | first_salary | salary_growth
------------+------+---------+--------------+--------------
          1 | 2020 | 50000.00| 50000.00     |      0.00
          1 | 2021 | 52000.00| 50000.00     |   2000.00
          1 | 2022 | 55000.00| 50000.00     |   5000.00
          1 | 2023 | 58000.00| 50000.00     |   8000.00
          2 | 2021 | 45000.00| 45000.00     |      0.00
          2 | 2022 | 47000.00| 45000.00     |   2000.00
          2 | 2023 | 50000.00| 45000.00     |   5000.00
```

## –ü—Ä–∏–º–µ—Ä 2: –ê–Ω–∞–ª–∏–∑ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞ –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞

```sql
-- –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –∑–∞–∫–∞–∑–æ–≤
CREATE TABLE customer_orders (
    order_id INT,
    customer_id INT,
    order_date DATE,
    amount DECIMAL(10, 2)
);

-- –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–º–∏
INSERT INTO customer_orders VALUES
(1, 101, '2023-01-05', 100.00),
(2, 101, '2023-01-15', 150.00),
(3, 101, '2023-02-10', 200.00),
(4, 102, '2023-01-10', 75.00),
(5, 102, '2023-03-01', 125.00),
(6, 103, '2023-02-20', 300.00);

-- –ó–∞–ø—Ä–æ—Å —Å FIRST_VALUE()
SELECT 
    order_id,
    customer_id,
    order_date,
    amount,
    FIRST_VALUE(order_date) OVER (PARTITION BY customer_id ORDER BY order_date) AS first_order_date,
    FIRST_VALUE(amount) OVER (PARTITION BY customer_id ORDER BY order_date) AS first_order_amount,
    amount - FIRST_VALUE(amount) OVER (PARTITION BY customer_id ORDER BY order_date) AS amount_increase
FROM customer_orders
ORDER BY customer_id, order_date;
```

–†–µ–∑—É–ª—å—Ç–∞—Ç:
```
order_id | customer_id | order_date | amount | first_order_date | first_order_amount | amount_increase
---------+-------------+------------+--------+------------------+--------------------+----------------
       1 |         101 | 2023-01-05 | 100.00 | 2023-01-05       | 100.00             |           0.00
       2 |         101 | 2023-01-15 | 150.00 | 2023-01-05       | 100.00             |          50.00
       3 |         101 | 2023-02-10 | 200.00 | 2023-01-05       | 100.00             |         100.00
       4 |         102 | 2023-01-10 |  75.00 | 2023-01-10       |  75.00             |           0.00
       5 |         102 | 2023-03-01 | 125.00 | 2023-01-10       |  75.00             |          50.00
       6 |         103 | 2023-02-20 | 300.00 | 2023-02-20       | 300.00             |           0.00
```

## –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ `FIRST_VALUE()`:
1. –í—Å–µ–≥–¥–∞ —Ç—Ä–µ–±—É–µ—Ç `OVER()` —Å —É–∫–∞–∑–∞–Ω–∏–µ–º `PARTITION BY` –∏ `ORDER BY`
2. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –æ–∫–Ω–∞
3. –ü–æ–ª–µ–∑–µ–Ω –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π —Å –Ω–∞—á–∞–ª—å–Ω—ã–º–∏
4. –ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å `LAST_VALUE()` –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

–§—É–Ω–∫—Ü–∏—è –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ä–æ—Å—Ç–∞ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π, —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π —Å –∏—Å—Ö–æ–¥–Ω—ã–º–∏ –∏ –≤—ã—è–≤–ª–µ–Ω–∏—è —Ç–µ–Ω–¥–µ–Ω—Ü–∏–π.



# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `employees` —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ RANK()

```sql
-- –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É employees
CREATE TABLE employees (
    employee_id SERIAL PRIMARY KEY,
    employee_name VARCHAR(100) NOT NULL,
    department VARCHAR(50) NOT NULL,
    salary DECIMAL(10, 2) NOT NULL,
    hire_date DATE
);

-- –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
INSERT INTO employees (employee_name, department, salary, hire_date) VALUES
-- IT –æ—Ç–¥–µ–ª
('–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤', 'IT', 95000, '2020-03-15'),
('–ê–ª–µ–∫—Å–µ–π –°–º–∏—Ä–Ω–æ–≤', 'IT', 85000, '2019-07-22'),
('–ï–ª–µ–Ω–∞ –ö–æ–∑–ª–æ–≤–∞', 'IT', 75000, '2021-01-10'),
('–î–º–∏—Ç—Ä–∏–π –ò–≤–∞–Ω–æ–≤', 'IT', 110000, '2018-05-30'),

-- –§–∏–Ω–∞–Ω—Å—ã
('–û–ª—å–≥–∞ –ù–æ–≤–∏–∫–æ–≤–∞', 'Finance', 90000, '2019-11-12'),
('–ú–∏—Ö–∞–∏–ª –í–æ–ª–∫–æ–≤', 'Finance', 80000, '2020-08-05'),
('–ê–Ω–Ω–∞ –ö—É–∑–Ω–µ—Ü–æ–≤–∞', 'Finance', 70000, '2022-02-18'),

-- –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥
('–°–µ—Ä–≥–µ–π –ú–æ—Ä–æ–∑–æ–≤', 'Marketing', 85000, '2020-09-14'),
('–ù–∞—Ç–∞–ª—å—è –í–∞—Å–Ω–µ—Ü–æ–≤–∞', 'Marketing', 65000, '2021-06-27'),
('–ê—Ä—Ç–µ–º –õ–µ–±–µ–¥–µ–≤', 'Marketing', 95000, '2019-04-03'),

-- HR
('–í–∏–∫—Ç–æ—Ä–∏—è –°–æ–∫–æ–ª–æ–≤–∞', 'HR', 60000, '2021-03-20'),
('–ü–∞–≤–µ–ª –û—Ä–ª–æ–≤', 'HR', 55000, '2022-01-15'),
('–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞ –ó–∞–π—Ü–µ–≤–∞', 'HR', 70000, '2020-07-08');
```

## –ü—Ä–∏–º–µ—Ä –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ —Å RANK()

```sql
SELECT 
	employee_name, 
    employee_id,
    department,
    salary,
    RANK() OVER (ORDER BY salary DESC) AS global_rank,
    RANK() OVER (PARTITION BY department ORDER BY salary DESC) AS department_rank
FROM employees
ORDER BY global_rank;
```

## –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–ø–µ—Ä–≤—ã–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫):

```
 employee_id | department |  salary  | global_rank | department_rank
-------------+------------+----------+-------------+-----------------
           4 | IT         | 110000.00|           1 |               1
          11 | Marketing  |  95000.00|           2 |               1
           1 | IT         |  95000.00|           2 |               2
           5 | Finance    |  90000.00|           4 |               1
           8 | Marketing  |  85000.00|           5 |               2
           2 | IT         |  85000.00|           5 |               3
           6 | Finance    |  80000.00|           7 |               2
           3 | IT         |  75000.00|           8 |               4
          13 | HR         |  70000.00|           9 |               1
           7 | Finance    |  70000.00|           9 |               3
          10 | Marketing  |  65000.00|          11 |               3
          12 | HR         |  55000.00|          12 |               2
```

## –ø—Ä–∏–º–µ—Ä —Å DENSE_RANK()
```sql
SELECT 
	employee_name, 
    employee_id,
    department,
    salary,
    RANK() OVER (ORDER BY salary DESC) AS global_rank,
    DENSE_RANK()  OVER (ORDER BY salary DESC) AS global_dence_rank,
    RANK() OVER (PARTITION BY department ORDER BY salary DESC) AS department_rank,
    DENSE_RANK() OVER (PARTITION BY department ORDER BY salary DESC) AS dense_department_rank
FROM employees
ORDER BY global_rank;


```


## –ü–æ—è—Å–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö:
1. –¢–∞–±–ª–∏—Ü–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö —Å —Ä–∞–∑–Ω—ã–º–∏ –∑–∞—Ä–ø–ª–∞—Ç–∞–º–∏ –≤ —Ä–∞–∑–Ω—ã—Ö –æ—Ç–¥–µ–ª–∞—Ö
2. –í –¥–∞–Ω–Ω—ã—Ö —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ —Å–æ–∑–¥–∞–Ω—ã —Å–∏—Ç—É–∞—Ü–∏–∏ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –∑–∞—Ä–ø–ª–∞—Ç–∞–º–∏:
   - –î–≤–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ —Å –∑–∞—Ä–ø–ª–∞—Ç–æ–π 95000 (–≥–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–∞–Ω–≥ 2)
   - –î–≤–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ —Å –∑–∞—Ä–ø–ª–∞—Ç–æ–π 85000 (–≥–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–∞–Ω–≥ 5)
   - –î–≤–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ —Å –∑–∞—Ä–ø–ª–∞—Ç–æ–π 70000 (–≥–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–∞–Ω–≥ 9)
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –æ—Ç–¥–µ–ª–∞ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ (department_rank)



## DENSE_RANK()

–§—É–Ω–∫—Ü–∏—è `DENSE_RANK()` –≤ PostgreSQL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç—Ä–æ–∫ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –±–µ–∑ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –≤ —Ä–∞–Ω–≥–∞—Ö. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç `RANK()`, –æ–Ω–∞ –Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Ä–∞–Ω–≥–∏, –µ—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `DENSE_RANK()` –≤ PostgreSQL

–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —É –Ω–∞—Å –µ—Å—Ç—å —Ç–∞–±–ª–∏—Ü–∞ `sales`:

```sql
CREATE TABLE sales (
    id SERIAL PRIMARY KEY,
    employee TEXT,
    region TEXT,
    amount NUMERIC
);
```

–ò –∑–∞–ø–æ–ª–Ω–∏–º –µ—ë –¥–∞–Ω–Ω—ã–º–∏:

```sql
INSERT INTO sales (employee, region, amount) VALUES
('Alice', 'East', 1000),
('Bob', 'East', 1500),
('Charlie', 'East', 1500),
('Diana', 'East', 900),
('Eve', 'East', 800);
```

–¢–µ–ø–µ—Ä—å –º—ã —Ö–æ—Ç–∏–º –ø—Ä–∏—Å–≤–æ–∏—Ç—å —Ä–∞–Ω–≥ –∫–∞–∂–¥–æ–º—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∏—Ö —Å—É–º–º—ã –ø—Ä–æ–¥–∞–∂ –ø–æ —É–±—ã–≤–∞–Ω–∏—é:

```sql
SELECT
    employee,
    amount,
    DENSE_RANK() OVER (ORDER BY amount DESC) AS rank
FROM sales;
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

| employee | amount | rank |
| -------- | ------ | ---- |
| Bob      | 1500   | 1    |
| Charlie  | 1500   | 1    |
| Alice    | 1000   | 2    |
| Diana    | 900    | 3    |
| Eve      | 800    | 4    |

–ö–∞–∫ –≤–∏–¥–Ω–æ:

* `Bob` –∏ `Charlie` –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏ –ø–æ–ª—É—á–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–∞–Ω–≥ `1`.
* –°–ª–µ–¥—É—é—â–∏–π —Ä–∞–Ω–≥ ‚Äî `2`, –±–µ–∑ –ø—Ä–æ–ø—É—Å–∫–∞.




# ROW_NUMBER()


–§—É–Ω–∫—Ü–∏—è `ROW_NUMBER()` –≤ PostgreSQL –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –æ–∫–Ω–∞. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç `RANK()` –∏ `DENSE_RANK()`, –æ–Ω–∞ **–Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è** ‚Äî –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–µ –¥–∞–µ—Ç—Å—è **—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä**, –¥–∞–∂–µ –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã.

---

### –ü—Ä–∏–º–µ—Ä `ROW_NUMBER()` –≤ PostgreSQL

–ü—Ä–µ–¥—Å—Ç–∞–≤–∏–º, —É –Ω–∞—Å –µ—Å—Ç—å —Ç–∞ –∂–µ —Ç–∞–±–ª–∏—Ü–∞ `sales`:

```sql
CREATE TABLE sales (
    id SERIAL PRIMARY KEY,
    employee TEXT,
    region TEXT,
    amount NUMERIC
);
```

–î–∞–Ω–Ω—ã–µ:

```sql
INSERT INTO sales (employee, region, amount) VALUES
('Alice', 'East', 1000),
('Bob', 'East', 1500),
('Charlie', 'East', 1500),
('Diana', 'East', 900),
('Eve', 'East', 800);
```

–¢–µ–ø–µ—Ä—å –ø—Ä–∏—Å–≤–æ–∏–º –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–µ –Ω–æ–º–µ—Ä –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É–±—ã–≤–∞–Ω–∏—è –ø—Ä–æ–¥–∞–∂:

```sql
SELECT
    employee,
    amount,
    ROW_NUMBER() OVER (ORDER BY amount DESC) AS row_num
FROM sales;
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

| employee | amount | row\_num |
| -------- | ------ | -------- |
| Bob      | 1500   | 1        |
| Charlie  | 1500   | 2        |
| Alice    | 1000   | 3        |
| Diana    | 900    | 4        |
| Eve      | 800    | 5        |

### –û—Ç–ª–∏—á–∏–µ –æ—Ç DENSE\_RANK():

–ï—Å–ª–∏ –±—ã –≤—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ `DENSE_RANK()`, —Ç–æ `Bob` –∏ `Charlie` –∏–º–µ–ª–∏ –±—ã –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Ä–∞–Ω–≥ (`1`), –∞ `ROW_NUMBER()` –¥–∞–ª –∏–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –Ω–æ–º–µ—Ä–∞.

---



## SUM OVER (PARTITION BY ... ORDER BY ...) 


–í–æ—Ç –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∞–≥—Ä–µ–≥–∞—Ç–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ `SUM(*)` —Å –æ–∫–æ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π `OVER (PARTITION BY ... ORDER BY ...)` –≤ PostgreSQL ‚Äî —ç—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **–Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ–º–∞—è —Å—É–º–º–∞ (running total)** –ø–æ –≥—Ä—É–ø–ø–∞–º.

---

### –ò—Å—Ö–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞: `sales`

```sql
CREATE TABLE sales (
    id SERIAL PRIMARY KEY,
    employee TEXT,
    region TEXT,
    sale_date DATE,
    amount NUMERIC
);
```

–î–∞–Ω–Ω—ã–µ:

```sql
INSERT INTO sales (employee, region, sale_date, amount) VALUES
('Alice', 'East', '2024-01-01', 100),
('Alice', 'East', '2024-01-02', 200),
('Alice', 'East', '2024-01-03', 150),
('Bob', 'West',  '2024-01-01', 300),
('Bob', 'West',  '2024-01-03', 100),
('Bob', 'West',  '2024-01-04', 200);
```

---

### –ó–∞–¥–∞—á–∞:

–ü–æ–ª—É—á–∏—Ç—å **–Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—É—é —Å—É–º–º—É `amount` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞**, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ø–æ –¥–∞—Ç–µ –ø—Ä–æ–¥–∞–∂–∏.

---

### –ó–∞–ø—Ä–æ—Å —Å –æ–∫–æ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π:

```sql
SELECT
    employee,
    region,
    sale_date,
    amount,
    SUM(amount) OVER (PARTITION BY employee ORDER BY sale_date) AS running_total
FROM sales
ORDER BY employee, sale_date;
```

---

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

| employee | region | sale\_date | amount | running\_total |
| -------- | ------ | ---------- | ------ | -------------- |
| Alice    | East   | 2024-01-01 | 100    | 100            |
| Alice    | East   | 2024-01-02 | 200    | 300            |
| Alice    | East   | 2024-01-03 | 150    | 450            |
| Bob      | West   | 2024-01-01 | 300    | 300            |
| Bob      | West   | 2024-01-03 | 100    | 400            |
| Bob      | West   | 2024-01-04 | 200    | 600            |

---

üîπ **`PARTITION BY employee`** ‚Äî –¥–µ–ª–∞–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞.
üîπ **`ORDER BY sale_date`** ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è.
üîπ **`SUM(...) OVER (...)`** ‚Äî –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –∞–≥—Ä–µ–≥–∞—Ç–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –≤ –æ–∫–æ–Ω–Ω—É—é, –≤–æ–∑–≤—Ä–∞—â–∞—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å—Ç—Ä–æ—á–Ω–æ.

```sql
SELECT
    employee,
    sale_date,
    amount,
    AVG(amount) OVER (PARTITION BY employee ORDER BY sale_date ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS running_avg,
    MIN(amount) OVER (PARTITION BY employee ORDER BY sale_date ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS running_min
FROM sales
ORDER BY employee, sale_date;
```


–û—Ç–ª–∏—á–Ω–æ! PostgreSQL –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –æ–ø—Ü–∏–∏ `GROUP BY`**: `GROUPING SETS`, `ROLLUP` –∏ `CUBE`. –≠—Ç–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –¥–µ–ª–∞—Ç—å **–º–Ω–æ–≥–æ–º–µ—Ä–Ω—É—é –∞–≥—Ä–µ–≥–∞—Ü–∏—é** (–∫–∞–∫ –≤ OLAP) –∏ –∑–∞–º–µ–Ω—è—é—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–π (`UNION ALL`) –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ.

---

## üîπ 1. `GROUPING SETS` ‚Äî –Ø–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–æ–∫

–ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–¥–∞–≤–∞—Ç—å **–Ω–∞–±–æ—Ä—ã –≥—Ä—É–ø–ø–∏—Ä–æ–≤–æ–∫**, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å.

### –ü—Ä–∏–º–µ—Ä:

```sql
SELECT region, employee, SUM(amount)
FROM sales
GROUP BY GROUPING SETS (
  (region, employee),  -- –ø–æ —Ä–µ–≥–∏–æ–Ω—É –∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É
  (region),            -- —Ç–æ–ª—å–∫–æ –ø–æ —Ä–µ–≥–∏–æ–Ω—É
  ()                   -- –æ–±—â–∞—è —Å—É–º–º–∞ (–≤—Å–µ–≥–æ)
);
```

üü¢ –ê–Ω–∞–ª–æ–≥ `UNION ALL` —Ç—Ä–µ—Ö –æ—Ç–¥–µ–ª—å–Ω—ã—Ö `GROUP BY`.

---

## üîπ 2. `ROLLUP` ‚Äî –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è

–°–æ–∑–¥–∞–µ—Ç **–∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –ø–æ —É—Ä–æ–≤–Ω—è–º –∏–µ—Ä–∞—Ä—Ö–∏–∏**: –æ—Ç –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –∫ –æ–±–æ–±—â–µ–Ω–Ω—ã–º.

### –ü—Ä–∏–º–µ—Ä:

```sql
SELECT region, employee, SUM(amount)
FROM sales
GROUP BY ROLLUP(region, employee);
```

üîπ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:

* –°—É–º–º—É –ø–æ –∫–∞–∂–¥–æ–º—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É –≤ —Ä–µ–≥–∏–æ–Ω–µ.
* –°—É–º–º—É –ø–æ —Ä–µ–≥–∏–æ–Ω—É.
* –û–±—â—É—é —Å—É–º–º—É.

üìå –≠—Ç–æ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç:

```sql
GROUPING SETS (
  (region, employee),
  (region),
  ()
)
```

---

## üîπ 3. `CUBE` ‚Äî –ü–æ–ª–Ω–∞—è –º–Ω–æ–≥–æ–º–µ—Ä–Ω–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è

–í—ã—á–∏—Å–ª—è–µ—Ç **–≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏** –≥—Ä—É–ø–ø–∏—Ä–æ–≤–æ–∫ –ø–æ —É–∫–∞–∑–∞–Ω–Ω—ã–º –ø–æ–ª—è–º.

### –ü—Ä–∏–º–µ—Ä:

```sql
SELECT region, employee, SUM(amount)
FROM sales
GROUP BY CUBE(region, employee);
```

üîπ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:

* –°—É–º–º—É –ø–æ –∫–∞–∂–¥–æ–π –ø–∞—Ä–µ (region, employee),
* –°—É–º–º—É –ø–æ –∫–∞–∂–¥–æ–º—É `region` (–≤—Å–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏),
* –°—É–º–º—É –ø–æ –∫–∞–∂–¥–æ–º—É `employee` (–≤—Å–µ —Ä–µ–≥–∏–æ–Ω—ã),
* –û–±—â—É—é —Å—É–º–º—É (–≤—Å–µ –≤–º–µ—Å—Ç–µ).

üìå –≠–∫–≤–∏–≤–∞–ª–µ–Ω—Ç:

```sql
GROUPING SETS (
  (region, employee),
  (region),
  (employee),
  ()
)
```

---

## üîπ –ö–∞–∫ –ø–æ–Ω—è—Ç—å, –∫–∞–∫–∏–µ —Å—Ç—Ä–æ–∫–∏ –æ–±–æ–±—â–µ–Ω–Ω—ã–µ?

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `GROUPING(...)` ‚Äî –æ–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `1`, –µ—Å–ª–∏ –ø–æ–ª–µ **—Å–≤–µ—Ä–Ω—É—Ç–æ (NULL –∏–∑-–∑–∞ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏)**, –∏ `0` –µ—Å–ª–∏ –æ–Ω–æ —Ä–µ–∞–ª—å–Ω–æ –∏–∑ –¥–∞–Ω–Ω—ã—Ö.

### –ü—Ä–∏–º–µ—Ä —Å `ROLLUP`:

```sql
SELECT
  region,
  employee,
  SUM(amount),
  GROUPING(region) AS is_region_total,
  GROUPING(employee) AS is_employee_total
FROM sales
GROUP BY ROLLUP(region, employee);
```

---

## üß† –°—Ä–∞–≤–Ω–µ–Ω–∏–µ:

| –ö–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è     | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç                                       |
| --------------- | ------------------------------------------------ |
| `GROUPING SETS` | –Ø–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ—à—å –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–æ–∫           |
| `ROLLUP`        | –î–µ–ª–∞–µ—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –∏–µ—Ä–∞—Ä—Ö–∏–∏ (—Å–ª–µ–≤–∞ –Ω–∞–ø—Ä–∞–≤–æ) |
| `CUBE`          | –í—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏                         |

---






–§—É–Ω–∫—Ü–∏—è `CROSSTAB()` –≤ PostgreSQL ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± —Å–æ–∑–¥–∞—Ç—å **—Å–≤–æ–¥–Ω—É—é —Ç–∞–±–ª–∏—Ü—É (pivot table)**, –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞—è —Å—Ç—Ä–æ–∫–∏ –≤ **–∫–æ–ª–æ–Ω–∫–∏**, –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ Excel PivotTable. –û–Ω–∞ –≤—Ö–æ–¥–∏—Ç –≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ **`tablefunc`**, –∫–æ—Ç–æ—Ä–æ–µ –Ω—É–∂–Ω–æ —Å–Ω–∞—á–∞–ª–∞ –≤–∫–ª—é—á–∏—Ç—å.

---

## üîß 1. –ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å `tablefunc`

```sql
CREATE EXTENSION IF NOT EXISTS tablefunc;
```

---

## üìä 2. –ü—Ä–∏–º–µ—Ä –∑–∞–¥–∞—á–∏

–î–æ–ø—É—Å—Ç–∏–º, —É –Ω–∞—Å –µ—Å—Ç—å —Ç–∞–±–ª–∏—Ü–∞ –ø—Ä–æ–¥–∞–∂:

```sql
CREATE TABLE sales (
    employee TEXT,
    month TEXT,
    amount NUMERIC
);
```

### –ü—Ä–∏–º–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:

```sql
INSERT INTO sales VALUES
('Alice', 'Jan', 100),
('Alice', 'Feb', 150),
('Bob',   'Jan', 200),
('Bob',   'Feb', 250),
('Charlie', 'Jan', 300);
```

---

## üìå 3. –ü—Ä–æ—Å—Ç–æ–π `CROSSTAB`

–ú—ã —Ö–æ—Ç–∏–º –ø–æ–≤–µ—Ä–Ω—É—Ç—å —Å—Ç—Ä–æ–∫–∏ ‚Äî —á—Ç–æ–±—ã –∫–∞–∂–¥—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –±—ã–ª –≤ —Å—Ç—Ä–æ–∫–µ, –∞ –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü ‚Äî –≤ –∫–æ–ª–æ–Ω–∫–µ.

### üìò –°–∏–Ω—Ç–∞–∫—Å–∏—Å:

```sql
SELECT *
FROM crosstab(
  $$SELECT employee, month, amount FROM sales ORDER BY 1,2$$
) AS ct(employee TEXT, jan NUMERIC, feb NUMERIC);
```

### üü¢ –†–µ–∑—É–ª—å—Ç–∞—Ç:

| employee | jan | feb  |
| -------- | --- | ---- |
| Alice    | 100 | 150  |
| Bob      | 200 | 250  |
| Charlie  | 300 | NULL |

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

* `crosstab()` **–Ω–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è** ‚Äî –Ω—É–∂–Ω–æ –∑–∞—Ä–∞–Ω–µ–µ —É–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–ª–æ–Ω–æ–∫ (`jan`, `feb`, –∏ —Ç.–¥.).
* –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É Charlie –Ω–µ—Ç Feb) –±—É–¥—É—Ç **NULL**.

---

## üìå 4. `CROSSTAB` —Å –¥–≤—É–º—è –≤—Ö–æ–¥–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏ (–≥–∏–±–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç)

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∑–∞—Ä–∞–Ω–µ–µ –∑–∞–¥–∞—Ç—å **–ø–æ—Ä—è–¥–æ–∫ —Å—Ç–æ–ª–±—Ü–æ–≤**, –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤—Ç–æ—Ä–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä:

```sql
SELECT *
FROM crosstab(
  $$SELECT employee, month, amount FROM sales ORDER BY 1,2$$,
  $$SELECT DISTINCT month FROM sales ORDER BY month$$
) AS ct(employee TEXT, jan NUMERIC, feb NUMERIC);
```

---

## üß† –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `CROSSTAB()`:

* –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–≤–æ–¥–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü (Pivot Table).
* –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤.
* –ü–æ–≤–æ—Ä–æ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏.

---

–•–æ—á–µ—à—å –ø—Ä–∏–º–µ—Ä —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∫–æ–ª–æ–Ω–æ–∫ (—á–µ—Ä–µ–∑ PL/pgSQL) –∏–ª–∏ —Å –∞–≥—Ä–µ–≥–∞—Ü–∏–µ–π (`SUM`, `COUNT`)?



–§—É–Ω–∫—Ü–∏—è `STRING_AGG()` –≤ PostgreSQL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è —Å—Ç—Ä–æ–∫ –≤ –æ–¥–Ω—É, —Å –∑–∞–¥–∞–Ω–Ω—ã–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–º ‚Äî –æ—á–µ–Ω—å –ø–æ–ª–µ–∑–Ω–∞ –¥–ª—è –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–æ–≤.

---

## üìò –ü—Ä–∏–º–µ—Ä –Ω–∞ —Ç–∞–±–ª–∏—Ü–µ `sales`

–î–æ–ø—É—Å—Ç–∏–º, —É –Ω–∞—Å –µ—Å—Ç—å —Ç–∞–∫–∞—è —Ç–∞–±–ª–∏—Ü–∞:

```sql
CREATE TABLE sales (
    id SERIAL PRIMARY KEY,
    employee TEXT,
    region TEXT,
    amount NUMERIC
);
```

### –î–∞–Ω–Ω—ã–µ:

```sql
INSERT INTO sales (employee, region, amount) VALUES
('Alice', 'East', 100),
('Alice', 'East', 200),
('Bob',   'West', 300),
('Bob',   'West', 400),
('Charlie', 'East', 500);
```

---

## üîπ –ü—Ä–∏–º–µ—Ä 1: —Å–ø–∏—Å–æ–∫ —Å—É–º–º –ø–æ –∫–∞–∂–¥–æ–º—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É

```sql
SELECT employee,
       STRING_AGG(amount::TEXT, ', ') AS all_sales
FROM sales
GROUP BY employee;
```

üü¢ **–†–µ–∑—É–ª—å—Ç–∞—Ç:**

| employee | all\_sales |
| -------- | ---------- |
| Alice    | 100, 200   |
| Bob      | 300, 400   |
| Charlie  | 500        |

---

## üîπ –ü—Ä–∏–º–µ—Ä 2: —Å–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º

```sql
SELECT region,
       STRING_AGG(DISTINCT employee, ', ' ORDER BY employee) AS employees
FROM sales
GROUP BY region;
```

üü¢ **–†–µ–∑—É–ª—å—Ç–∞—Ç:**

| region | employees      |
| ------ | -------------- |
| East   | Alice, Charlie |
| West   | Bob            |

---

## üîπ –ü—Ä–∏–º–µ—Ä 3: –°–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ HTML-—Å–ø–∏—Å–∫–∞

```sql
SELECT region,
       '<ul><li>' || STRING_AGG(employee, '</li><li>') || '</li></ul>' AS html_list
FROM sales
GROUP BY region;
```

---

## üß† –û–±—â–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å:

```sql
STRING_AGG(expression, delimiter [ORDER BY ...])
```

* `expression` ‚Äî —á—Ç–æ –æ–±—ä–µ–¥–∏–Ω—è—Ç—å (–æ–±—ã—á–Ω–æ —Ç–µ–∫—Å—Ç).
* `delimiter` ‚Äî —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, `', '`).
* `ORDER BY` ‚Äî –µ—Å–ª–∏ –≤–∞–∂–µ–Ω –ø–æ—Ä—è–¥–æ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –∞–≥—Ä–µ–≥–∞—Ç–µ.

---

–•–æ—á–µ—à—å –ø—Ä–∏–º–µ—Ä —Å `JSON_AGG()` –∏–ª–∏ —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ –¥–∞—Ç–∞–º –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º –≤–∏–¥–µ?






–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å ‚Äî `TRUNCATE` –∏ `DELETE` –≤ PostgreSQL **–æ–±–∞ —É–¥–∞–ª—è—é—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã**, –Ω–æ **–¥–µ–ª–∞—é—Ç —ç—Ç–æ –ø–æ-—Ä–∞–∑–Ω–æ–º—É**.

---

## üß® –ì–ª–∞–≤–Ω–æ–µ –æ—Ç–ª–∏—á–∏–µ:

|                       | `DELETE`                         | `TRUNCATE`                      |
| --------------------- | -------------------------------- | ------------------------------- |
| **–°–∫–æ—Ä–æ—Å—Ç—å**          | –ú–µ–¥–ª–µ–Ω–Ω–æ (—Å—Ç—Ä–æ–∫–∞ –∑–∞ —Å—Ç—Ä–æ–∫–æ–π)     | –û—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ (–æ–±—Ä–µ–∑–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É) |
| **–í–æ–∑–≤—Ä–∞—Ç**           | –ú–æ–∂–Ω–æ `ROLLBACK` (–¥–∞)            | –ú–æ–∂–Ω–æ `ROLLBACK` (–¥–∞)           |
| **–¢—Ä–∏–≥–≥–µ—Ä—ã**          | **–°—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç** (`AFTER DELETE`) | **–ù–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç**              |
| **WHERE**             | –î–∞ ‚Äî –º–æ–∂–Ω–æ –≤—ã–±–æ—Ä–æ—á–Ω–æ             | ‚ùå ‚Äî —É–¥–∞–ª—è–µ—Ç **–≤—Å—ë**             |
| **–°–±—Ä–æ—Å ID**          | –ù–µ—Ç                              | –î–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å `SERIAL`)         |
| **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏**        | –ë–ª–æ–∫–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫–∏                 | –ë–ª–æ–∫–∏—Ä—É–µ—Ç **–≤—Å—é —Ç–∞–±–ª–∏—Ü—É**       |
| **–í–ª–∏—è–Ω–∏–µ –Ω–∞ VACUUM** | –¢—Ä–µ–±—É–µ—Ç `VACUUM` –ø–æ—Å–ª–µ           | –ù–µ —Ç—Ä–µ–±—É–µ—Ç                      |

---

## üîç –ü—Ä–∏–º–µ—Ä—ã:

### `DELETE`: —É–¥–∞–ª—è–µ—Ç **–ø–æ —É—Å–ª–æ–≤–∏—é** –∏ –≤—ã–∑—ã–≤–∞–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä—ã

```sql
DELETE FROM sales WHERE employee = 'Alice';
```

* –ú–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å.
* –¢—Ä–∏–≥–≥–µ—Ä—ã `AFTER DELETE` —Å—Ä–∞–±–æ—Ç–∞—é—Ç.
* –ú–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å —á–∞—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö.

---

### `TRUNCATE`: —É–¥–∞–ª—è–µ—Ç **–≤—Å—ë** –±—ã—Å—Ç—Ä–æ

```sql
TRUNCATE TABLE sales;
```

* –ù–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `WHERE`.
* –û—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ ‚Äî –æ—á–∏—â–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É –±–µ–∑ —á—Ç–µ–Ω–∏—è —Å—Ç—Ä–æ–∫.
* –°–±—Ä–æ—Å–∏—Ç —Å—á—ë—Ç—á–∏–∫ `SERIAL` (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞—Ç—å `RESTART IDENTITY OFF`).

---

## ‚ö†Ô∏è –í–ª–∏—è–Ω–∏–µ –Ω–∞ `SERIAL` / `IDENTITY`

```sql
TRUNCATE TABLE sales RESTART IDENTITY;
-- ID —Å–Ω–æ–≤–∞ –Ω–∞—á–Ω–µ—Ç—Å—è —Å 1
```

```sql
TRUNCATE TABLE sales CONTINUE IDENTITY;
-- ID –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Å —Ç–µ–∫—É—â–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
```

---

## ‚úÖ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

| –°–∏—Ç—É–∞—Ü–∏—è                        | –ò—Å–ø–æ–ª—å–∑—É–π                    |
| ------------------------------- | ---------------------------- |
| –£–¥–∞–ª–∏—Ç—å –≤—ã–±–æ—Ä–æ—á–Ω–æ               | `DELETE`                     |
| –ù—É–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä—ã          | `DELETE`                     |
| –û—á–∏—Å—Ç–∏—Ç—å **–≤—Å—é** —Ç–∞–±–ª–∏—Ü—É –±—ã—Å—Ç—Ä–æ | `TRUNCATE`                   |
| –û—Å–≤–æ–±–æ–¥–∏—Ç—å –º–µ—Å—Ç–æ, —Å–±—Ä–æ—Å–∏—Ç—å ID   | `TRUNCATE`                   |
| –ï—Å—Ç—å –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ ‚Äî –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ! | –õ—É—á—à–µ `DELETE` –∏–ª–∏ `CASCADE` |

---

–•–æ—á–µ—à—å –ø—Ä–∏–º–µ—Ä, –≥–¥–µ `TRUNCATE` –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑-–∑–∞ –≤–Ω–µ—à–Ω–µ–≥–æ –∫–ª—é—á–∞ (`FOREIGN KEY`)?





–í PostgreSQL –º–æ–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å **—Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å—é –¥–∞–Ω–Ω—ã—Ö** —á–µ—Ä–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (constraints), —Ç–∞–∫–∏–µ –∫–∞–∫:

1. **–í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ (`FOREIGN KEY`)**
2. **–ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (`DEFAULT`)**
3. **–£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å (`UNIQUE`)**

–í–æ—Ç –∫–∞–∫ –¥–æ–±–∞–≤–ª—è—Ç—å —ç—Ç–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è ‚Äî –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü—ã –∏ **–Ω–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ç–∞–±–ª–∏—Ü—É**.

---

## üìå 1. **–í–Ω–µ—à–Ω–∏–π –∫–ª—é—á (`FOREIGN KEY`)**

–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å—Å—ã–ª–æ—á–Ω—É—é —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å: –∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –¥—Ä—É–≥–æ–π —Ç–∞–±–ª–∏—Ü–µ.

### –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü—ã:

```sql
CREATE TABLE orders (
    id SERIAL PRIMARY KEY,
    customer_id INT REFERENCES customers(id)
);
```

–ò–ª–∏ —è–≤–Ω–æ:

```sql
CREATE TABLE orders (
    id SERIAL PRIMARY KEY,
    customer_id INT,
    FOREIGN KEY (customer_id) REFERENCES customers(id)
);
```

### –ö —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ç–∞–±–ª–∏—Ü–µ:

```sql
ALTER TABLE orders
ADD CONSTRAINT fk_customer
FOREIGN KEY (customer_id) REFERENCES customers(id);
```

---

## üìå 2. **–ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (`DEFAULT`)**

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ, –µ—Å–ª–∏ –æ–Ω–æ –Ω–µ —É–∫–∞–∑–∞–Ω–æ –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ.

### –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü—ã:

```sql
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    price NUMERIC DEFAULT 0.0,
    created_at TIMESTAMP DEFAULT now()
);
```

### –ö —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ç–∞–±–ª–∏—Ü–µ:

```sql
ALTER TABLE products
ALTER COLUMN price SET DEFAULT 0.0;
```

–£–¥–∞–ª–∏—Ç—å `DEFAULT`:

```sql
ALTER TABLE products
ALTER COLUMN price DROP DEFAULT;
```

---

## üìå 3. **–£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ (`UNIQUE`)**

–ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –∫–æ–ª–æ–Ω–∫–µ (–∏–ª–∏ –Ω–∞–±–æ—Ä–µ –∫–æ–ª–æ–Ω–æ–∫) —É–Ω–∏–∫–∞–ª—å–Ω—ã.

### –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü—ã:

```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    email TEXT UNIQUE
);
```

–ò–ª–∏ —Å —è–≤–Ω—ã–º –∏–º–µ–Ω–µ–º:

```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    email TEXT,
    CONSTRAINT unique_email UNIQUE (email)
);
```

### –ö —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ç–∞–±–ª–∏—Ü–µ:

```sql
ALTER TABLE users
ADD CONSTRAINT unique_email UNIQUE (email);
```

---

## üîê –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å `UNIQUE` –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–ª–æ–Ω–æ–∫:

```sql
ALTER TABLE orders
ADD CONSTRAINT unique_order_combo UNIQUE (customer_id, product_id);
```

---

## üí° –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (CHECK)

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –º–æ–∂–Ω–æ –∑–∞–¥–∞–≤–∞—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```sql
ALTER TABLE products
ADD CONSTRAINT check_price_positive CHECK (price > 0);
```

---







### **–ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (Materialized Views)**

**–ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è** –≤ PostgreSQL ‚Äî —ç—Ç–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è, —á—å–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –≤–∏–¥–µ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π —Ç–∞–±–ª–∏—Ü—ã. –û–Ω–∏ –º–æ–≥—É—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ø–æ–≤—ã—Å–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –ø–æ—Å–∫–æ–ª—å–∫—É –∑–∞–ø—Ä–æ—Å—ã –∫ –Ω–∏–º –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º –∫ –æ–±—ã—á–Ω—ã–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è–º, –ø–æ—Å–∫–æ–ª—å–∫—É –¥–∞–Ω–Ω—ã–µ —É–∂–µ –≤—ã—á–∏—Å–ª–µ–Ω—ã –∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

---

## üìå 1. **–°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è**

–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞ `CREATE MATERIALIZED VIEW`. –ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ.

### –ü—Ä–∏–º–µ—Ä:

```sql
CREATE MATERIALIZED VIEW sales_summary AS
SELECT region, SUM(amount) AS total_sales
FROM sales
GROUP BY region;
```

–≠—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å —Å–æ–∑–¥–∞—ë—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º.

---

## üìå 2. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è**

–ß—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ (—Ç–∞–∫ –∫–∞–∫ –æ–Ω–æ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏), –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞ `REFRESH MATERIALIZED VIEW`.

### –ü—Ä–∏–º–µ—Ä:

```sql
REFRESH MATERIALIZED VIEW sales_summary;
```

### –í–∞–∂–Ω–æ–µ –∑–∞–º–µ—á–∞–Ω–∏–µ:

* `REFRESH` –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–∏.
* –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å **—Ä–µ—Å—É—Ä—Å–æ—ë–º–∫–æ–π** –æ–ø–µ—Ä–∞—Ü–∏–µ–π, –æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏—Ö –Ω–∞–±–æ—Ä–æ–≤ –¥–∞–Ω–Ω—ã—Ö.

---

## üìå 3. **–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (Partial Refresh)**

PostgreSQL **–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** –¥–ª—è –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π –Ω–∞–ø—Ä—è–º—É—é, –Ω–æ –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ **—Å –ø–æ–º–æ—â—å—é —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤, –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π**. –≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –∏–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

### –ò–¥–µ—è:

* –°–æ–∑–¥–∞—ë–º —Ç–∞–±–ª–∏—Ü—É –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏).
* –î–ª—è –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —á–∞—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö.

---

### –ü—Ä–∏–º–µ—Ä –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

–î–æ–ø—É—Å—Ç–∏–º, —É –Ω–∞—Å –µ—Å—Ç—å —Ç–∞–±–ª–∏—Ü–∞ `sales` –∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ `sales_summary`.

1. **–®–∞–≥ 1: –°–æ–∑–¥–∞—ë–º —Ç–∞–±–ª–∏—Ü—É –∏–∑–º–µ–Ω–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø—Ä–æ–¥–∞–∂)**:

```sql
CREATE TABLE sales_changes (
    id SERIAL PRIMARY KEY,
    region TEXT,
    amount NUMERIC,
    change_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

2. **–®–∞–≥ 2: –¢—Ä–∏–≥–≥–µ—Ä –¥–ª—è –∑–∞–ø–∏—Å–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ `sales_changes`**:

```sql
CREATE OR REPLACE FUNCTION log_sales_changes() RETURNS trigger AS $$
BEGIN
    INSERT INTO sales_changes (region, amount) VALUES (NEW.region, NEW.amount);
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER sales_insert_trigger
AFTER INSERT OR UPDATE ON sales
FOR EACH ROW
EXECUTE FUNCTION log_sales_changes();
```

3. **–®–∞–≥ 3: –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è**:

```sql
CREATE OR REPLACE FUNCTION refresh_sales_summary() RETURNS void AS $$
BEGIN
    -- –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –∏–ª–∏ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    INSERT INTO sales_summary (region, total_sales)
    SELECT region, SUM(amount)
    FROM sales_changes
    GROUP BY region
    ON CONFLICT (region) 
    DO UPDATE SET total_sales = EXCLUDED.total_sales;

    -- –û—á–∏—â–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –∏–∑–º–µ–Ω–µ–Ω–∏–π
    TRUNCATE sales_changes;
END;
$$ LANGUAGE plpgsql;
```

4. **–®–∞–≥ 4: –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**:

–í—ã –º–æ–∂–µ—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —Å –ø–æ–º–æ—â—å—é `pg_cron` –∏–ª–∏ –≤ –∫–∞–∫–æ–π-—Ç–æ –º–æ–º–µ–Ω—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å `refresh_sales_summary()` –≤—Ä—É—á–Ω—É—é.

```sql
SELECT refresh_sales_summary();
```

---

### –í–∞–∂–Ω–æ–µ –∑–∞–º–µ—á–∞–Ω–∏–µ:

* –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è **–¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö** –∏–ª–∏ **–∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö** –¥–∞–Ω–Ω—ã—Ö. –ï—Å–ª–∏ –≤ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–∏–∑–æ—à–ª–∏ **–º–∞—Å—Å–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –±—ã–ª–æ —É–¥–∞–ª–µ–Ω–æ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–æ), –≤–æ–∑–º–æ–∂–Ω–æ, –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±–Ω–æ–≤–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ.
* –î–ª—è **–æ—á–∏—Å—Ç–∫–∏** –∏–ª–∏ **–ø–æ–ª–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π `REFRESH MATERIALIZED VIEW`.

---

## üìå 4. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è**

–ß—Ç–æ–±—ã —É—Å–∫–æ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–º—É –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—é, –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã:

```sql
CREATE INDEX idx_sales_summary_region ON sales_summary(region);
```

–ò–Ω–¥–µ–∫—Å—ã —É—Å–∫–æ—Ä—è—é—Ç –ø–æ–∏—Å–∫ –ø–æ –∫–æ–ª–æ–Ω–∫–∞–º, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –±–æ–ª—å—à–æ–µ.

---

## üß† –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

* **–ü–æ–≤—ã—à–µ–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, —Ç–∞–∫ –∫–∞–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É–∂–µ –≤—ã—á–∏—Å–ª–µ–Ω –∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω.
* **–ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏** –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.

### –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:

* **–ù–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**. –¢—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤.
* **–ó–∞–Ω–∏–º–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ** –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

---

–•–æ—á–µ—à—å –ø—Ä–∏–º–µ—Ä –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω–æ–≥–æ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü –∏–ª–∏ —Å –∞–≥—Ä–µ–≥–∞—Ü–∏–µ–π –∑–∞ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –≤—Ä–µ–º–µ–Ω–∏?




### 2. **–°–æ–∑–¥–∞–Ω–∏–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π (Sequences)**

**–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å (Sequence)** ‚Äî —ç—Ç–æ –æ–±—ä–µ–∫—Ç –≤ PostgreSQL, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —á–∏—Å–µ–ª, —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π, –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –∫–ª—é—á–µ–π.

---

#### 1. **–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (Sequence)**

–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞ `CREATE SEQUENCE`.

–ü—Ä–∏–º–µ—Ä:

```sql
CREATE SEQUENCE seq_employee_id
  START 1
  INCREMENT 1
  MINVALUE 1
  MAXVALUE 1000000
  CACHE 1;
```

* `START 1` ‚Äî –Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.
* `INCREMENT 1` ‚Äî —à–∞–≥ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1).
* `MINVALUE` –∏ `MAXVALUE` ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ).
* `CACHE 1` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–Ω–∞—á–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ—ë –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π.

---

#### 2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Sequence –∫–∞–∫ Default –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü—ã**

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫–∞–∫ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –ø–æ–ª—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞.

–ü—Ä–∏–º–µ—Ä:

```sql
CREATE TABLE employees (
    id INT DEFAULT nextval('seq_employee_id') PRIMARY KEY,
    name TEXT NOT NULL
);
```

–ó–¥–µ—Å—å `nextval('seq_employee_id')` –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è —Å—Ç–æ–ª–±—Ü–∞ `id` –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏.

---

#### 3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Sequence –≤ –¥—Ä—É–≥–∏—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö**

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `nextval`:

```sql
SELECT nextval('seq_employee_id');
```

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –±–µ–∑ –µ—ë —É–≤–µ–ª–∏—á–µ–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `currval`:

```sql
SELECT currval('seq_employee_id');
```

–î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `setval`:

```sql
SELECT setval('seq_employee_id', 1000);
```

–≠—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ `1000`. –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –≤—ã–∑–æ–≤–µ `nextval` –±—É–¥–µ—Ç –≤–æ–∑–≤—Ä–∞—â–µ–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ `1001`.

---

#### 4. **–†–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Sequence**

–ï—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ **–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å** –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞—á–∞—Ç—å —Å–Ω–æ–≤–∞ —Å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `setval`:

```sql
SELECT setval('seq_employee_id', 1, false);
```

* –ü–µ—Ä–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä ‚Äî —ç—Ç–æ –∏–º—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.
* –í—Ç–æ—Ä–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä ‚Äî –∑–Ω–∞—á–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ.
* –¢—Ä–µ—Ç–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä (–µ—Å–ª–∏ `false`) —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ —Å–ª–µ–¥—É—é—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –±—É–¥–µ—Ç —Ä–∞–≤–Ω–æ 1, –∞ –Ω–µ 2 (–µ—Å–ª–∏ –±—ã–ª–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ 1).

–¢–∞–∫–∂–µ –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –µ—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ –±—ã–ª–∞ –æ—á–∏—â–µ–Ω–∞ –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –±—ã–ª–∏ –æ—Ç—Ä–∞–∂–µ–Ω—ã:

```sql
SELECT setval('seq_employee_id', (SELECT max(id) FROM employees));
```

---

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Sequence –≤ —Ä–µ–∞–ª—å–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ:

1. –°–æ–∑–¥–∞—ë–º —Ç–∞–±–ª–∏—Ü—É —Å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é:

```sql
CREATE SEQUENCE seq_order_id START 1;
```

```sql
CREATE TABLE orders (
    order_id INT DEFAULT nextval('seq_order_id') PRIMARY KEY,
    order_date DATE NOT NULL,
    customer_id INT NOT NULL
);
```

2. –í—Å—Ç–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü—É:

```sql
INSERT INTO orders (order_date, customer_id) VALUES ('2025-05-07', 1);
INSERT INTO orders (order_date, customer_id) VALUES ('2025-05-08', 2);
```

–ö–∞–∂–¥—ã–π –∑–∞–∫–∞–∑ –±—É–¥–µ—Ç –ø–æ–ª—É—á–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–π —Å –ø–æ–º–æ—â—å—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

---

### –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

* **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** –≤ PostgreSQL –æ—á–µ–Ω—å —É–¥–æ–±–Ω—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π, –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –∫–ª—é—á–µ–π.
* **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `nextval`** –∏ `setval` –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.
* –í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ –∫–∞—á–µ—Å—Ç–≤–µ **–∑–Ω–∞—á–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** –¥–ª—è —Å—Ç–æ–ª–±—Ü–æ–≤ —Ç–∞–±–ª–∏—Ü.





# –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –∏ —Ç–∏–ø—ã –∏–Ω–¥–µ–∫—Å–æ–≤ –≤ PostgreSQL

**–ò–Ω–¥–µ–∫—Å—ã** ‚Äî —ç—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ —É—Å–∫–æ—Ä—è—é—Ç –ø–æ–∏—Å–∫ —Å—Ç—Ä–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö. –û–Ω–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ø–æ–≤—ã—Å–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —á–∞—Å—Ç–æ –≤—ã–ø–æ–ª–Ω—è—é—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π –∏–ª–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö. –û–¥–Ω–∞–∫–æ –∏–Ω–¥–µ–∫—Å—ã —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç –≤—Ä–µ–º—è –Ω–∞ –≤—Å—Ç–∞–≤–∫—É, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö, —Ç–∞–∫ –∫–∞–∫ –∏–Ω–¥–µ–∫—Å –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å.

---

### 1. **–°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞**

–ò–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã `CREATE INDEX`.

–ü—Ä–∏–º–µ—Ä:

```sql
CREATE INDEX idx_employee_name ON employees(name);
```

–≠—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å —Å–æ–∑–¥–∞—ë—Ç –∏–Ω–¥–µ–∫—Å –Ω–∞ —Å—Ç–æ–ª–±–µ—Ü `name` –≤ —Ç–∞–±–ª–∏—Ü–µ `employees`. –ò–Ω–¥–µ–∫—Å –ø–æ–º–æ–∂–µ—Ç —É—Å–∫–æ—Ä–∏—Ç—å –ø–æ–∏—Å–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø–æ –∏–º–µ–Ω–∏.

---

### 2. **–¢–∏–ø—ã –∏–Ω–¥–µ–∫—Å–æ–≤ –≤ PostgreSQL**

–í PostgreSQL –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∏–ø–æ–≤ –∏–Ω–¥–µ–∫—Å–æ–≤. –ö–∞–∂–¥—ã–π —Ç–∏–ø –∏–Ω–¥–µ–∫—Å–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∏–ª–∏ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö.

#### **1. B-tree (–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é)**

**B-tree** ‚Äî —ç—Ç–æ —Ç–∏–ø –∏–Ω–¥–µ–∫—Å–∞, –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è **–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** –≤ PostgreSQL. –û–Ω –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö, —Ç–∞–∫–∏—Ö –∫–∞–∫ `INTEGER`, `TEXT`, `DATE`, –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ **—Ä–∞–≤–µ–Ω—Å—Ç–≤–∞** –∏ **–¥–∏–∞–ø–∞–∑–æ–Ω–∞**.

–ü—Ä–∏–º–µ—Ä:

```sql
CREATE INDEX idx_employee_id ON employees(id);
```

–ò–Ω–¥–µ–∫—Å **B-tree** —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π:

* `=`, `<`, `<=`, `>`, `>=`, `BETWEEN`, `IN` –∏ –¥—Ä—É–≥–∏–µ.

#### **2. Hash**

–ò–Ω–¥–µ–∫—Å **Hash** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–π **—Ä–∞–≤–µ–Ω—Å—Ç–≤–∞** (`=`), –Ω–æ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–∏–∞–ø–∞–∑–æ–Ω–∞. –í PostgreSQL —ç—Ç–æ—Ç —Ç–∏–ø –∏–Ω–¥–µ–∫—Å–∞ –æ–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ–∏—Å–∫–∞ –ø–æ —Ç–æ—á–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é.

–ü—Ä–∏–º–µ—Ä:

```sql
CREATE INDEX idx_employee_name_hash ON employees USING HASH (name);
```

–û–¥–Ω–∞–∫–æ —Å—Ç–æ–∏—Ç –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ **B-tree** –∏–Ω–¥–µ–∫—Å —á–∞—Å—Ç–æ –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –æ–ø–µ—Ä–∞—Ü–∏–π, –∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ **Hash** –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ.

#### **3. GiST (Generalized Search Tree)**

**GiST** ‚Äî —ç—Ç–æ –æ–±–æ–±—â—ë–Ω–Ω—ã–π –∏–Ω–¥–µ–∫—Å, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è **–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö** –∏ —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, —Ç–∞–∫–∏—Ö –∫–∞–∫ –ø–æ–∏—Å–∫ –ø–æ –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–º –¥–∞–Ω–Ω—ã–º, –ø–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–º –¥–∞–Ω–Ω—ã–º –∏ –¥—Ä—É–≥–∏–µ.

–ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞ –¥–ª—è –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è PostGIS):

```sql
CREATE INDEX idx_location ON locations USING GIST (location);
```

#### **4. GIN (Generalized Inverted Index)**

**GIN** ‚Äî —ç—Ç–æ –∏–Ω–¥–µ–∫—Å, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–ª—è **–ø–æ–∏—Å–∫–∞ –ø–æ –Ω–∞–±–æ—Ä—É –∑–Ω–∞—á–µ–Ω–∏–π** –∏ —Ä–∞–±–æ—Ç—ã —Å **–º–∞—Å—Å–∏–≤–∞–º–∏**, **—Ç–µ–∫—Å—Ç–æ–≤—ã–º–∏ –ø–æ–∏—Å–∫–æ–≤—ã–º–∏ –∏–Ω–¥–µ–∫—Å–∞–º–∏** –∏–ª–∏ **JSONB**.

–ü—Ä–∏–º–µ—Ä –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞:

```sql
CREATE INDEX idx_search_text ON documents USING GIN (to_tsvector('english', content));
```

–≠—Ç–æ—Ç —Ç–∏–ø –∏–Ω–¥–µ–∫—Å–∞ –æ—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è **–ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞** –∏ **–ø–æ–∏—Å–∫–∞ –ø–æ –º–∞—Å—Å–∏–≤–∞–º**.

#### **5. SP-GiST (Space-partitioned Generalized Search Tree)**

**SP-GiST** ‚Äî —ç—Ç–æ —Ä–∞–∑–Ω–æ–≤–∏–¥–Ω–æ—Å—Ç—å **GiST** –∏–Ω–¥–µ–∫—Å–∞, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è **–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** –∏ –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö —Å **–¥–µ—Ä–µ–≤—å—è–º–∏** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –ø–æ–∏—Å–∫–∞ –±–ª–∏–∂–∞–π—à–∏—Ö —Ç–æ—á–µ–∫ –∏–ª–∏ –ø–æ–∏—Å–∫–∞ –ø–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º).

–ü—Ä–∏–º–µ—Ä:

```sql
CREATE INDEX idx_spgist_location ON locations USING SPGIST (location);
```

#### **6. BRIN (Block Range INdexes)**

**BRIN** ‚Äî —ç—Ç–æ –∏–Ω–¥–µ–∫—Å, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–ª—è —Ç–∞–±–ª–∏—Ü —Å **–±–æ–ª—å—à–∏–º–∏ –æ–±—ä–µ–º–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö**, –≥–¥–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Å—Ç–æ–ª–±—Ü–∞—Ö –∏–º–µ—é—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫, –∫–∞–∫, –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–∞–Ω–Ω—ã–µ —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏.

–ü—Ä–∏–º–µ—Ä:

```sql
CREATE INDEX idx_brin_timestamp ON events USING BRIN (event_time);
```

–≠—Ç–æ—Ç –∏–Ω–¥–µ–∫—Å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω –¥–ª—è –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü —Å —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ –∏–ª–∏ –ø–æ—Ä—è–¥–∫–æ–≤—ã–µ –Ω–æ–º–µ—Ä–∞).

---

### 3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**

#### **1. –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ç–æ–ª–±—Ü–∞—Ö (Composite Index)**

–ò–Ω–¥–µ–∫—Å—ã –º–æ–≥—É—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω—ã –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ç–æ–ª–±—Ü–∞—Ö, —á—Ç–æ –º–æ–∂–µ—Ç —É—Å–∫–æ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤.

–ü—Ä–∏–º–µ—Ä:

```sql
CREATE INDEX idx_employee_dept_salary ON employees(department, salary);
```

–≠—Ç–æ—Ç –∏–Ω–¥–µ–∫—Å –±—É–¥–µ—Ç –ø–æ–ª–µ–∑–µ–Ω –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ **`department`** –∏ **`salary`**.

#### **2. –ò–Ω–¥–µ–∫—Å —Å –≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º (Function-Based Index)**

–ò–Ω–¥–µ–∫—Å—ã —Ç–∞–∫–∂–µ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–∞ –≤—ã—Ä–∞–∂–µ–Ω–∏—è—Ö –∏–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö —Ñ—É–Ω–∫—Ü–∏–π. –≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞ –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π.

–ü—Ä–∏–º–µ—Ä:

```sql
CREATE INDEX idx_lower_name ON employees (LOWER(name));
```

–≠—Ç–æ—Ç –∏–Ω–¥–µ–∫—Å —É—Å–∫–æ—Ä—è–µ—Ç –ø–æ–∏—Å–∫ –ø–æ —Å—Ç—Ä–æ–∫–∞–º, –∏–≥–Ω–æ—Ä–∏—Ä—É—è —Ä–µ–≥–∏—Å—Ç—Ä —Å–∏–º–≤–æ–ª–æ–≤.

#### **3. –ò–Ω–¥–µ–∫—Å—ã —Å —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å—é (Unique Index)**

–ò–Ω–¥–µ–∫—Å —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è `UNIQUE`. –≠—Ç–æ—Ç –∏–Ω–¥–µ–∫—Å –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Å—Ç–æ–ª–±—Ü–µ –∏–ª–∏ –Ω–∞–±–æ—Ä–µ —Å—Ç–æ–ª–±—Ü–æ–≤ –±—É–¥—É—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏.

–ü—Ä–∏–º–µ—Ä:

```sql
CREATE UNIQUE INDEX idx_unique_email ON employees(email);
```

–≠—Ç–æ—Ç –∏–Ω–¥–µ–∫—Å –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –≤—Å–µ email-–∞–¥—Ä–µ—Å–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ –±—É–¥—É—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏.

---

### 4. **–£–¥–∞–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞**

–î–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞ `DROP INDEX`.

–ü—Ä–∏–º–µ—Ä:

```sql
DROP INDEX IF EXISTS idx_employee_name;
```

---

### 5. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö**

PostgreSQL –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ—à–∞–µ—Ç, –∫–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω–¥–µ–∫—Å, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏ —Ç–∏–ø–∞ –∑–∞–ø—Ä–æ—Å–∞. –û–¥–Ω–∞–∫–æ, –∏–Ω–¥–µ–∫—Å—ã —Ç–∞–∫–∂–µ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≤—Ä—É—á–Ω—É—é, –Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É `EXPLAIN`.

–ü—Ä–∏–º–µ—Ä:

```sql
EXPLAIN SELECT * FROM employees WHERE name = 'John';
```

–ï—Å–ª–∏ –∏–Ω–¥–µ–∫—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, PostgreSQL –ø–æ–∫–∞–∂–µ—Ç —ç—Ç–æ –≤ –ø–ª–∞–Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞.

---

### 6. **–ò–Ω–¥–µ–∫—Å—ã –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**

* –ò–Ω–¥–µ–∫—Å—ã —É—Å–∫–æ—Ä—è—é—Ç **–ø–æ–∏—Å–∫** –∏ **—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É**, –Ω–æ –º–æ–≥—É—Ç –∑–∞–º–µ–¥–ª—è—Ç—å **–≤—Å—Ç–∞–≤–∫—É**, **–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** –∏ **—É–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**, —Ç–∞–∫ –∫–∞–∫ –∏–Ω–¥–µ–∫—Å—ã –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö.
* –ò–Ω–¥–µ–∫—Å—ã —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç **–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞**.
* –ò–Ω–¥–µ–∫—Å—ã —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã –¥–ª—è **—á–∞—Å—Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤**, –Ω–æ –Ω–µ –≤—Å–µ–≥–¥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã –¥–ª—è —Ç–∞–±–ª–∏—Ü —Å —Ä–µ–¥–∫–∏–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∏–ª–∏ —Å –Ω–µ–±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –¥–∞–Ω–Ω—ã—Ö.

---

–ï—Å–ª–∏ —Ç—ã —Ö–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å, –∫–∞–∫ –≤—ã–±–∏—Ä–∞—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–∏–π —Ç–∏–ø –∏–Ω–¥–µ–∫—Å–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–ª–∏ –¥—Ä—É–≥–∏—Ö –∞—Å–ø–µ–∫—Ç–æ–≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –Ω–µ —Å—Ç–µ—Å–Ω—è–π—Å—è —Å–ø—Ä–∞—à–∏–≤–∞—Ç—å!





