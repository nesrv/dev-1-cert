
### 2. **Создание и использование последовательностей (Sequences)**

**Последовательность (Sequence)** — это объект в PostgreSQL, предназначенный для генерации уникальных чисел, часто используется для создания уникальных значений, например, для первичных ключей.

---

#### 1. **Создание последовательности (Sequence)**

Для создания последовательности используется команда `CREATE SEQUENCE`.

Пример:

```sql
CREATE SEQUENCE seq_employee_id
  START 1
  INCREMENT 1
  MINVALUE 1
  MAXVALUE 1000000
  CACHE 1;
```

* `START 1` — начальное значение последовательности.
* `INCREMENT 1` — шаг последовательности (по умолчанию 1).
* `MINVALUE` и `MAXVALUE` — минимальное и максимальное значения (необязательно).
* `CACHE 1` — количество значений, которые должны быть кэшированы для улучшения производительности.

После создания последовательности можно использовать её для получения значений.

---

#### 2. **Использование Sequence как Default значение при создании таблицы**

Можно использовать последовательность как значение по умолчанию для поля, например, для создания уникальных значений первичного ключа.

Пример:

```sql
CREATE TABLE employees (
    id INT DEFAULT nextval('seq_employee_id') PRIMARY KEY,
    name TEXT NOT NULL
);
```

Здесь `nextval('seq_employee_id')` будет вызываться для генерации следующего уникального значения для столбца `id` при вставке новой строки.

---

#### 3. **Использование Sequence в других запросах**

Для получения следующего значения последовательности можно использовать функцию `nextval`:

```sql
SELECT nextval('seq_employee_id');
```

Если нужно получить текущее значение последовательности без её увеличения, используется `currval`:

```sql
SELECT currval('seq_employee_id');
```

Для установки значения последовательности вручную используется `setval`:

```sql
SELECT setval('seq_employee_id', 1000);
```

Это установит значение последовательности в `1000`. При следующем вызове `nextval` будет возвращено значение `1001`.

---

#### 4. **Реинициализация Sequence**

Если необходимо **перезагрузить** последовательность, например, начать снова с определённого значения, используйте функцию `setval`:

```sql
SELECT setval('seq_employee_id', 1, false);
```

* Первый параметр — это имя последовательности.
* Второй параметр — значение, которое должно быть установлено.
* Третий параметр (если `false`) указывает, что следующее значение будет равно 1, а не 2 (если было установлено на 1).

Также можно установить последовательность на максимальное значение, если таблица была очищена или изменения не были отражены:

```sql
SELECT setval('seq_employee_id', (SELECT max(id) FROM employees));
```

---

### Пример использования Sequence в реальном контексте:

1. Создаём таблицу с последовательностью:

```sql
CREATE SEQUENCE seq_order_id START 1;
```

```sql
CREATE TABLE orders (
    order_id INT DEFAULT nextval('seq_order_id') PRIMARY KEY,
    order_date DATE NOT NULL,
    customer_id INT NOT NULL
);
```

2. Вставляем данные в таблицу:

```sql
INSERT INTO orders (order_date, customer_id) VALUES ('2025-05-07', 1);
INSERT INTO orders (order_date, customer_id) VALUES ('2025-05-08', 2);
```

Каждый заказ будет получать уникальный идентификатор, генерируемый с помощью последовательности.

---

### Заключение

* **Последовательности** в PostgreSQL очень удобны для генерации уникальных значений, например, для первичных ключей.
* **Использование `nextval`** и `setval` позволяет управлять значениями последовательности.
* Вы можете использовать последовательности в качестве **значений по умолчанию** для столбцов таблиц.
