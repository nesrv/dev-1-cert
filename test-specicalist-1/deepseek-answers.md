Для успешной сдачи экзамена **Dev-1 PostgreSQL** (например, в рамках курсов или сертификации) важно понимать основные концепции СУБД, SQL-запросы, администрирование и оптимизацию.  

### **Примерные вопросы и ответы для подготовки**  

#### **1. Основы PostgreSQL**  
**Вопрос**: Что такое PostgreSQL и каковы его основные особенности?  
**Ответ**:  
PostgreSQL — это объектно-реляционная СУБД с открытым исходным кодом. Особенности:  
- Поддержка ACID (транзакции, целостность данных).  
- Расширяемость: пользовательские типы данных, функции, расширения (`pg_partman`, `PostGIS`).  
- Поддержка JSON/JSONB, полнотекстового поиска, репликации.  

---  

#### **2. SQL-запросы**  
**Вопрос**: Как найти 5 самых высокооплачиваемых сотрудников?  
**Ответ**:  
```sql
SELECT name, salary 
FROM employees 
ORDER BY salary DESC 
LIMIT 5;
```  

---  

#### **3. Индексы**  
**Вопрос**: Зачем нужны индексы и как создать индекс на поле `email` в таблице `users`?  
**Ответ**:  
Индексы ускоряют поиск данных. Создание:  
```sql
CREATE INDEX idx_users_email ON users(email);
```  
**Важно**: Индексы замедляют `INSERT/UPDATE/DELETE`, так как их нужно перестраивать.  

---  

#### **4. Транзакции**  
**Вопрос**: Что такое транзакция? Приведите пример.  
**Ответ**:  
Транзакция — это атомарная группа SQL-запросов. Пример:  
```sql
BEGIN;
UPDATE accounts SET balance = balance - 100 WHERE user_id = 1;
UPDATE accounts SET balance = balance + 100 WHERE user_id = 2;
COMMIT;  -- или ROLLBACK в случае ошибки
```  

---  

#### **5. Оптимизация запросов**  
**Вопрос**: Как проанализировать медленный запрос?  
**Ответ**:  
Использовать `EXPLAIN ANALYZE`:  
```sql
EXPLAIN ANALYZE SELECT * FROM orders WHERE status = 'shipped';
```  
Это покажет план выполнения и время.  

---  

#### **6. Резервное копирование**  
**Вопрос**: Как сделать дамп базы данных?  
**Ответ**:  
Через утилиту `pg_dump`:  
```bash
pg_dump -U username -d dbname -f backup.sql
```  

---  

#### **7. Настройка репликации**  
**Вопрос**: Какие типы репликации поддерживает PostgreSQL?  
**Ответ**:  
- **Физическая репликация** (бинарная, WAL-логи).  
- **Логическая репликация** (на уровне таблиц).  

---  

#### **8. Оконные функции**  
**Вопрос**: Как найти второй самый высокий оклад в каждом отделе?  
**Ответ**:  
```sql
SELECT department_id, name, salary 
FROM (
    SELECT 
        department_id, 
        name, 
        salary,
        DENSE_RANK() OVER (PARTITION BY department_id ORDER BY salary DESC) as rank
    FROM employees
) ranked 
WHERE rank = 2;
```  

---  

#### **9. Подготовленные операторы**  
**Вопрос**: Для чего нужны подготовленные операторы?  
**Ответ**:  
- Ускорение повторяющихся запросов.  
- Защита от SQL-инъекций.  
Пример:  
```sql
PREPARE get_user (int) AS SELECT * FROM users WHERE id = $1;
EXECUTE get_user(1);
```  

---  

#### **10. Мониторинг**  
**Вопрос**: Как посмотреть активные подключения к БД?  
**Ответ**:  
```sql
SELECT * FROM pg_stat_activity;
```  

---  

### **Дополнительные темы для изучения**  
- **Партиционирование таблиц**.  
- **Работа с JSONB**.  
- **Настройка автовакуума (autovacuum)**.  
- **Локи и конкурентный доступ**.  

### **Советы для сдачи**  
1. Практикуйтесь в написании SQL-запросов (например, на [SQLex](https://sql-ex.ru/)).  
2. Разберитесь с `EXPLAIN` и оптимизацией.  
3. Попробуйте настроить репликацию на тестовом стенде.  




Вот еще подборка возможных вопросов и ответов для подготовки к экзамену **Dev-1 PostgreSQL** (или аналогичного уровня). Вопросы охватывают ключевые темы: от базового синтаксиса до администрирования.

## ДОПОЛНИТЕЛЬНО

### **1. Основы SQL**
**Вопрос**: Как выбрать уникальные значения из столбца `department` в таблице `employees`?  
**Ответ**:  
```sql
SELECT DISTINCT department FROM employees;
```

---

### **2. Работа с JOIN**
**Вопрос**: Чем отличается `INNER JOIN` от `LEFT JOIN`? Приведите пример.  
**Ответ**:  
- `INNER JOIN` возвращает только совпадающие строки из обеих таблиц.  
- `LEFT JOIN` возвращает **все** строки из левой таблицы и совпадения из правой (если нет совпадений — `NULL`).  

Пример:  
```sql
-- INNER JOIN (только сотрудники с отделами)
SELECT e.name, d.name 
FROM employees e 
INNER JOIN departments d ON e.department_id = d.id;

-- LEFT JOIN (все сотрудники, даже без отдела)
SELECT e.name, d.name 
FROM employees e 
LEFT JOIN departments d ON e.department_id = d.id;
```

---

### **3. Агрегатные функции**
**Вопрос**: Как найти среднюю зарплату по отделам?  
**Ответ**:  
```sql
SELECT department, AVG(salary) 
FROM employees 
GROUP BY department;
```

---

### **4. Подзапросы**
**Вопрос**: Как найти сотрудников, чья зарплата выше средней?  
**Ответ**:  
```sql
SELECT name, salary 
FROM employees 
WHERE salary > (SELECT AVG(salary) FROM employees);
```

---

### **5. Изменение данных**
**Вопрос**: Как обновить поле `last_login` для пользователя с `id = 5`?  
**Ответ**:  
```sql
UPDATE users 
SET last_login = NOW() 
WHERE id = 5;
```

---

### **6. Управление транзакциями**
**Вопрос**: Что произойдет, если в транзакции произойдет ошибка?  
**Ответ**:  
Если не обработать ошибку явно, транзакция останется в состоянии "прервана" (не будет ни `COMMIT`, ни `ROLLBACK`). Лучшая практика — использовать `BEGIN ... EXCEPTION ... END` в PL/pgSQL или автоматический `ROLLBACK` в приложении.

---

### **7. Индексы**
**Вопрос**: Почему индекс не используется в запросе `SELECT * FROM users WHERE LOWER(name) = 'alice'`?  
**Ответ**:  
Индексы по умолчанию не работают с функциями (если нет **функционального индекса**). Решение:  
```sql
CREATE INDEX idx_users_lower_name ON users (LOWER(name));
```

---

### **8. Оконные функции**
**Вопрос**: Как сравнить зарплату каждого сотрудника со средней по отделу?  
**Ответ**:  
```sql
SELECT 
    name, 
    salary,
    AVG(salary) OVER (PARTITION BY department_id) as avg_department_salary
FROM employees;
```

---

### **9. Расширения PostgreSQL**
**Вопрос**: Как подключить расширение `pgcrypto` для шифрования данных?  
**Ответ**:  
```sql
CREATE EXTENSION IF NOT EXISTS pgcrypto;
-- Пример использования:
SELECT crypt('password', gen_salt('bf'));
```

---

### **10. Резервное копирование**
**Вопрос**: Как восстановить БД из дампа?  
**Ответ**:  
```bash
psql -U username -d dbname -f backup.sql
```

---

### **11. Мониторинг**
**Вопрос**: Как найти самые медленные запросы в PostgreSQL?  
**Ответ**:  
```sql
SELECT query, total_time 
FROM pg_stat_statements 
ORDER BY total_time DESC 
LIMIT 10;
```
**Примечание**: Требуется включить расширение `pg_stat_statements` в `postgresql.conf`.

---

### **12. Блокировки (Locking)**
**Вопрос**: Как проверить, какие блокировки сейчас активны?  
**Ответ**:  
```sql
SELECT locktype, relation::regclass, mode, pid 
FROM pg_locks 
WHERE granted = true;
```

---

### **13. Оптимизация**
**Вопрос**: Почему запрос `SELECT * FROM large_table` может быть плохой идеей?  
**Ответ**:  
- Он загружает **все** строки, что потребляет много памяти.  
- Нет фильтрации (`WHERE`) или лимита (`LIMIT`).  
- Лучше использовать пагинацию:  
  ```sql
  SELECT * FROM large_table LIMIT 100 OFFSET 0;
  ```

---

### **14. Партиционирование**
**Вопрос**: Зачем нужно партиционирование таблиц?  
**Ответ**:  
- Ускорение запросов (сканируется только нужная партиция).  
- Упрощение управления данными (например, удаление старых данных через `DROP PARTITION`).  

---

### **15. JSON в PostgreSQL**
**Вопрос**: Как выбрать поле `email` из JSONB-столбца `profile`?  
**Ответ**:  
```sql
SELECT profile->>'email' FROM users;
```
**Примечание**: `->>` возвращает текст, `->` — JSONB.

---

### **Где практиковаться?**
1. **Тестовые БД**: [PostgreSQL Exercises](https://pgexercises.com/).  
2. **SQL-тренажеры**: [LeetCode](https://leetcode.com/), [HackerRank](https://www.hackerrank.com/domains/sql).  
3. **Локальный стенд**: Установите PostgreSQL и экспериментируйте с примерами выше.  

Если нужно углубиться в конкретную тему (например, репликацию или PL/pgSQL) — спрашивай! 😊